!function(e,t){"use strict";angular.module("adf",["adf.provider","ui.bootstrap","opengate-angular-js"]).value("adfTemplatePath","../src/templates/").value("columnTemplate",'<adf-dashboard-column column="column" adf-model="adfModel" options="options" edit-mode="editMode" ng-repeat="column in row.columns" />').value("adfVersion","8.7.1"),angular.module("adf").directive("adfDashboard",["$rootScope","$log","$timeout","$uibModal","dashboard","adfTemplatePath","$translate","Upload",function(e,i,n,o,a,r,l,d){function c(e){switch(angular.isDefined(e)?e.toLowerCase():null){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function s(e){var t={},i=a.widgets[e].config||{};return t=angular.copy(i)}function f(e){var t={},i=a.widgets[e];return i&&(t=angular.copy(i)),t}function g(t,n,o,a){if(t){t.grid||(t.grid=[]);var r={width:3,height:2,x:0,y:0,definition:n};t.grid.push(r),e.$broadcast("adfWidgetAdded",o,t,n),a&&e.$broadcast("adfDashboardChanged",o,t)}else i.error("model is undefined")}function u(e){var t=a.widgets[e];return t&&t.edit&&t.edit.immediate}function p(e,t){n(function(){e.$broadcast("adfWidgetEnterEditMode",t)},200)}function m(e){var t={};return angular.forEach(e,function(e,i){var n=e.category;n||(n="ADF.CATEGORY.MISCELANOUS"),e.title=l.instant(e.title),e.description=l.instant(e.description),e.category=l.instant(e.category),angular.isUndefined(t[e.category])&&(t[e.category]={widgets:{}}),t[e.category].widgets[i]=e}),t}function h(e){var t=[];return angular.forEach(e,function(e,i){e.category||(e.category="ADF.CATEGORY.MISCELLANEOUS"),e.title=l.instant(e.title),e.description=l.instant(e.description),e.category=l.instant(e.category),e.categoryTags||(e.categoryTags="ADF.CATEGORY.TAG.MISCELLANEOUS");var n=e.categoryTags.split(","),o=[];angular.forEach(n,function(e,i){var n=l.instant(e);t.indexOf(n)===-1&&t.push(n),o.indexOf(n)===-1&&o.push(n)}),e.categoryTags=o.toString()}),t}return{replace:!0,restrict:"EA",transclude:!1,scope:{name:"@",collapsible:"@",editable:"@",editMode:"@",continuousEditMode:"=",maximizable:"@",adfModel:"=",adfWidgetFilter:"=",categories:"@",hideButtons:"=",extraData:"="},controller:["$scope",function(n){function c(){var e=n.$new();return e}var v={extraConfig:{cellHeight:145}},w=null,b=n.name,y=function(e){var t={configChange:[],reload:[]};if(e){var i=angular.copy(e.definition),n=i.Ftype,o=i.wid,a=i.config||{},r=a.filter;v.grid.forEach(function(e){var i=e.definition.config.filter,a=e.definition.Ftype;i&&i.id&&i.id===o?(e.definition.config.filter=r,e.definition.config.filter.id=o,t.reload.push(e.definition.wid)):n===a&&t.configChange.push(e.definition.wid)})}return t},C=function(e){var t=[],i=e.grid;i&&i.length>0&&i.forEach(function(e){var i=e.definition,n=i.config||{},o=n.filter;t.push({wid:i.wid,title:i.title,filter:o,Ftype:i.Ftype})}),n.options||(n.options={extraData:{}}),n.options.extraData.widgetFilters=t};n.$watch("adfModel",function(e,t){(null!==t||null===e&&null===t)&&(v=n.adfModel,w=n.adfWidgetFilter,v?(C(v),v.title||(v.title=l.instant("ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD")),v.titleTemplateUrl||(v.titleTemplateUrl=r+"dashboard-title.html"),v.extraConfig?v.extraConfig.cellHeight||(v.extraConfig.cellHeight=145):v.extraConfig={cellHeight:145},n.model=v):i.error("could not find or create model"))},!0),n.editMode=!1,n.toggleEditMode=function(t){n.editMode=!n.editMode,n.editMode&&(n.continuousEditMode||(n.modelCopy=angular.copy(n.adfModel,{}),e.$broadcast("adfIsEditMode")),t&&n.editDashboardDialog()),n.editMode||e.$broadcast("adfDashboardChanged",b,v)};var S=n.$on("adfToggleEditMode",function(e,t){t?n.toggleEditMode(!0):n.toggleEditMode()}),$=n.$on("adfCancelEditMode",function(e){n.editMode&&n.cancelEditMode()}),D=n.$on("adfWidgetRemovedFromGrid",function(e,t){var i=null;angular.forEach(n.adfModel.grid,function(e,n){e.definition.wid===t.wid&&(i=n)}),i>=0&&n.adfModel.grid.splice(i,1)}),F=n.$on("adfWidgetRemovedFromGridAndSave",function(e,t){var i=null;n.toggleEditMode(),angular.forEach(n.adfModel.grid,function(e,n){e.definition.wid===t.wid&&(i=n)}),i>=0&&n.adfModel.grid.splice(i,1),n.toggleEditMode()});n.cancelEditMode=function(){n.editMode=!1,n.continuousEditMode||n.modelCopy===n.adfModel||(n.modelCopy=angular.copy(n.modelCopy,n.adfModel)),e.$broadcast("adfDashboardEditsCancelled",n.adfModel.title,n.adfModel)};var E=n.$on("adfEditDashboardDialog",function(e){n.editMode&&n.editDashboardDialog()}),M=n.$on("adfLaunchSearchingFromWidget",function(t,i){var n=y(i);e.$broadcast("adfFilterChanged",b,v,n)}),T=n.$on("adfWindowTimeChangedFromWidget",function(t){e.$broadcast("adfFilterChanged",b,v)});n.editDashboardDialog=function(){var i=c();i.copy={title:"ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD"!==v.title?v.title:"",description:v.description,backgroundColor:v.backgroundColor?v.backgroundColor:t,time:new Date,backgroundImage:v.backgroundImage?v.backgroundImage:t,file:v.backgroundImage?v.backgroundImage:t,extraConfig:angular.copy(v.extraConfig)},i.backgroundSize={name:"backgroundSize",model:v.backgroundImageSize?v.backgroundImageSize:"100% 100%",options:{"100% 100%":{title:l.instant("SIZE_CONF.AUTO")},contain:{title:l.instant("SIZE_CONF.CONTAIN")},cover:{title:l.instant("SIZE_CONF.COVER")}}},i.iconConfiguration={name:"iconConfiguration",model:v.iconType?v.iconType:"icon",url:t,file:t,iconType:v.iconType?v.iconType:"icon",icon:"icon"===v.iconType?v.icon:"fa-tachometer",options:{icon:{title:l.instant("ICON.LIBRARY")},image:{title:l.instant("ICON.IMAGE")}}},"image"===i.iconConfiguration.iconType&&(i.iconConfiguration.file=v.icon,i.iconConfiguration.url=v.icon),i.imageSelected=function(e){e?(i.iconConfiguration.file=e,d.base64DataUrl(e).then(function(e){i.iconConfiguration.url=e,i.iconConfiguration.file=e,i.iconConfiguration.iconType="image"})):i.removeDataFile()},i.backgroundImageSelected=function(e){e?(i.iconConfiguration.file=e,d.base64DataUrl(e).then(function(e){i.copy.backgroundImage=e,i.copy.file=e})):i.removeBackgroundFile()},i.removeDataFile=function(){i.iconConfiguration.file=null,i.iconConfiguration.url=null},i.removeBackgroundFile=function(){i.copy.backgroundImage=null,i.copy.file=null};var n=r+"dashboard-edit.html";v.editTemplateUrl&&(n=v.editTemplateUrl);var a=o.open({scope:i,templateUrl:n,backdrop:"static",keyboard:!1,size:"lg"});i.closeDialog=function(n){n?console.warn("Dashboard config cancelled by user"):(v.title=i.copy.title,v.description=i.copy.description,"image"===i.iconConfiguration.model?v.icon=i.iconConfiguration.url:"icon"===i.iconConfiguration.model&&(v.icon=i.iconConfiguration.icon&&i.iconConfiguration.icon.key||i.iconConfiguration.icon),v.iconType=i.iconConfiguration.model,v.backgroundColor=i.copy.backgroundColor?i.copy.backgroundColor:t,v.backgroundImage=i.copy.backgroundImage?i.copy.backgroundImage:t,v.backgroundImageSize=i.backgroundSize.model,v.extraConfig=i.copy.extraConfig?i.copy.extraConfig:t,e.$broadcast("adfDashboardInternalConfigChanged",v)),a.close(),i.$destroy()}};var I=n.$on("adfOpenWidgetFromOther",function(e,t,i){var o=s(t),a=angular.merge({},o,i||{}),r={type:t,config:a,title:a.title};g(v,r,b,!n.editMode)}),O=n.$on("adfOpenModalWidgetFromOther",function(t,i,a,l){var d=r+"widget-fullscreen.html",c=a||{};c.sendSelection&&(d=r+"widget-fullscreen-selection.html");var s;if(l)s=l;else{var g=f(i);g.config=angular.merge({},g.config,c),g.type=i,g.config.title&&(g.title=g.config.title),s=n.$new(),s.definition=s.widget=g}var u={scope:s,templateUrl:d,size:s.definition.modalSize||"el",backdrop:"static",windowClass:s.definition.fullScreen?"dashboard-modal widget-fullscreen":"dashboard-modal"};n.model&&!n.model.temporal&&(s.persistDashboard=function(){e.$broadcast("adfOpenWidgetFromOther",this.$parent.widget.type,this.$parent.widget.config||{}),this.closeDialog()});var p=o.open(u);s.closeDialog=function(){p.close(),l?s.reload():s.$destroy()}}),A=n.$on("adfAddWidgetDialog",function(t){!v.temporal&&v.editable&&(n.editMode||(n.editMode=!0,n.modelCopy=angular.copy(n.adfModel,{}),e.$broadcast("adfIsEditMode")),n.addWidgetDialog())});n.addScopeCfg={widgetFilter:{},widgetSortingDirection:"",widgetSorting:"priority"},n.addWidgetDialog=function(){var e,t=c();angular.isFunction(w)?(e={},angular.forEach(a.widgets,function(t,i){w(t,i,v)&&(e[i]=t)})):e=a.widgets,t.widgets=e,angular.forEach(t.widgets,function(e,t){e.key=t,e.category||(e.category="ADF.CATEGORY.MISCELLANEOUS")}),n.options.categories?t.createCategories=m:t.availableCategories=h(e);var i=r+"widget-add.html";v.addTemplateUrl&&(i=v.addTemplateUrl);var l={scope:t,templateUrl:i,backdrop:"static",size:"lg"},d=o.open(l);t.widgetFilterCfg=n.addScopeCfg,t.addWidget=function(e){var i={type:e,Ftype:a.widgets[e].Ftype||null,config:s(e)};g(v,i,b),d.close(),t.$destroy(),u(e)&&p(n,i)},t.changeThumbnail=function(e){e.images&&(angular.isUndefined(e._currThumb)?e._currThumb=1:e._currThumb+=1,e._currThumb>=e.images.length&&(e._currThumb=0),e._currImg=e.images[e._currThumb])},t.closeDialog=function(){d.close(),t.$destroy()}},n.addNewWidgetToModel=g,n.$on("destroy",function(){M(),T(),S(),I(),O(),$(),A(),E(),D(),F()})}],link:function(e,t,i){var n={name:i.name,editable:!0,enableConfirmDelete:c(i.enableConfirmDelete),maximizable:c(i.maximizable),collapsible:c(i.collapsible),categories:c(i.categories),extraData:{}};angular.isDefined(i.editable)&&(n.editable=c(i.editable)),angular.isDefined(e.extraData)&&(n.extraData=e.extraData),n.extraData.editing=e.editMode,e.options=n},templateUrl:r+"dashboard.html"}}]),angular.module("adf").directive("adfDashboardGrid",["adfTemplatePath",function(e){function t(e){i.disableDrag=!e.editMode,i.disableResize=!e.editMode,e.gridOptions=i,e.gsHandler=null}var i={cellHeight:145,verticalMargin:10,animate:!0,"float":!1,alwaysShowResizeHandle:!0,minWidth:768,auto:!0,resizable:{handles:"e, se, s, sw, w"},disableDrag:!0,disableResize:!0};return{restrict:"E",scope:{adfModel:"=",editMode:"=",continuousEditMode:"=",options:"="},templateUrl:e+"dashboard-grid.html",compile:function(){return{pre:t}},controller:["$scope","$timeout",function(e,t){var n=[];n.push(e.$on("adfIsEditMode",function(){t(function(){e.gsHandler.enable()},100)})),n.push(e.$on("adfDashboardChanged",function(){t(function(){e.gsHandler.disable()},100)})),n.push(e.$on("adfDashboardEditsCancelled",function(i,n,o){o&&o.extraConfig&&angular.isNumber(o.extraConfig.cellHeight)&&e.gsHandler.cellHeight(o.extraConfig.cellHeight),t(function(){e.gsHandler.disable()},100)})),n.push(e.$on("adfDashboardInternalConfigChanged",function(t,i){i&&i.extraConfig&&angular.isNumber(i.extraConfig.cellHeight)&&e.gsHandler.cellHeight(i.extraConfig.cellHeight)})),n.push(e.$on("adfCancelEditMode",function(){t(function(){e.gsHandler.disable()},100)})),n.push(e.$on("adfWidgetAdded",function(i){t(function(){e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.gsHandler.enable()},100)})),e.onChange=function(t,i){e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onDragStop=function(t,i){console.log("onDragStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onResizeStop=function(t,i){console.log("onResizeStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.$broadcast("OnResizeWidget")},e.adfModel&&e.adfModel.extraConfig&&angular.isNumber(e.adfModel.extraConfig.cellHeight)&&(i.cellHeight=e.adfModel.extraConfig.cellHeight),e.$on("$destroy",function(){n.forEach(function(e){e()})})}]}}]),angular.module("adf").filter("adfOrderByObjectKey",["$filter",function(e){return function(t,i){var n=[];return angular.forEach(t,function(e,t){e[i]=t,n.push(e)}),e("orderBy")(n,i)}}]),angular.module("adf.provider",[]).provider("dashboard",function(){var e={},t="",i='<div class="alert alert-primary">{}</div>',n='      <div class="progress progress-striped active">\n        <div class="progress-bar" role="progressbar" style="width: 100%">\n          <span class="sr-only" translate>FORM.MSG.LOADING ...</span>\n        </div>\n      </div>',o=null,a=function(){return!0};this.widget=function(t,i){var n=angular.extend({reload:!1,frameless:!1},i);if(n.edit){var o={reload:!0,immediate:!1,apply:a};angular.extend(o,n.edit),n.edit=o}return n.config||(n.config={}),e[t]=n,this},this.widgetsPath=function(e){return t=e,this},this.messageTemplate=function(e){return i=e,this},this.loadingTemplate=function(e){return n=e,this},this.customWidgetTemplatePath=function(e){return o=e,this},this.$get=function(){var a=0;return{widgets:e,widgetsPath:t,messageTemplate:i,loadingTemplate:n,customWidgetTemplatePath:o,id:function(){return(new Date).getTime()+"-"+ ++a},idEquals:function(e,t){return e&&t&&e.toString()===t.toString()}}}}),angular.module("adf").directive("adfWidgetContent",["$log","$q","widgetService","$compile","$controller","$injector","dashboard","$translate",function(i,n,o,a,r,l,d,c){function s(e,t){i.warn(t),e.html(d.messageTemplate.replace(/{}/g,t))}function f(i,n,o,a){function r(t){if("custom"===t)return{from:u.config.windowFilter.from,to:u.config.windowFilter.to};if("today"===t)return{from:e.moment().startOf("day")};var i=e.moment().subtract(1,t);return{from:i._d}}var l=i.model;if(!l)return c("ADF.ERROR.MODEL_IS_UNDEFINED").then(function(e){s(n,e)}),o;var d=i.content;if(!d)return c("ADF.ERROR.WIDGET_FOR_DEPRECTATED",{title:l.title}).then(function(e){s(n,e)}),o;var f=i.extra,u=o;if(u){var p=!(u.menu===t||null===u.menu||u.isPaginationEnable&&u.isPaginationEnable());if(p||a||!angular.isFunction(u.reloadData))i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),u=g(i,n,o,l,d,f);else{var m=u.itemsPerPage!==t&&null!==u.itemsPerPage;(m||u.page)&&(u.page=1),u.reloadData()}}else i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),u=g(i,n,o,l,d,f);return u.config.getWindowTime=function(){var t=u.config.windowFilter;if(t&&t.type){var i=r(t.type);if(!e.eval(u.config.windowFilter.rawdate)){for(var n in i)i[n]=e.moment(i[n]).format();i.rawdate=!0}return i}},f&&(u.editing=!!f.editing,u.extraData=f),u}function g(e,i,f,g,u,p){i.html(d.loadingTemplate);var m=e.$new();g.config||(g.config={}),m.config=g.config,m.editing=p&&p.editing,p&&(m.extra=p);var h=f||m.config;m.selectionManager=h?h.selectionManager:t;var v={$scope:m,widget:g,config:g.config},w={};return w.$tpl=o.getTemplate(u),u.resolve&&angular.forEach(u.resolve,function(e,t){angular.isString(e)?w[t]=l.get(e):w[t]=l.invoke(e,e,v)}),n.all(w).then(function(e){angular.extend(e,v),u.resolveAs&&(m[u.resolveAs]=e);var t=e.$tpl;if(i.html(t),u.controller){var n=r(u.controller,e);u.controllerAs&&(m[u.controllerAs]=n),i.children().data("$ngControllerController",n)}a(i.contents())(m)},function(e){var t="ADF.ERROR.COULD_NOT_RESOLVE_ALL_PROMISSES";c(t,{reason:e?": "+e:e}).then(function(e){s(i,e)})}),f&&f.$destroy(),m}return{replace:!0,restrict:"EA",transclude:!1,require:"?^^adfWidgetGrid",scope:{model:"=",content:"=",extra:"=",navOptionsHandler:"=?",filterHandler:"=?",widgetActionsHandler:"=?"},link:function(e,t,i,n){var o=f(e,t,null);n&&(e.search=e.search||{},n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id));var a=e.$on("widgetConfigChanged",function(i,a){a?a.indexOf(e.model.wid)!==-1&&n&&n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id,!0):o=f(e,t,o,!0)}),r=e.$on("widgetReload",function(i,a){var r=!0;a&&a.length>0&&(r=a.indexOf(e.model.wid)!==-1),r&&(o=f(e,t,o,!1),n&&n.updateWidgetFilters&&n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id))});e.$on("destroy",function(){a(),r()})}}}]),angular.module("adf").directive("adfWidgetGrid",["$injector","$q","$log","$uibModal","$rootScope","$interval","dashboard","adfTemplatePath","Filter","toastr","$translate",function(e,i,n,o,a,r,l,d,c,s,f){function g(e){var t=e.definition;if(t){var i=l.widgets[t.type];if(i){t.title||(t.title=i.title),t.titleTemplateUrl=d+"widget-grid-title.html",t.editTemplateUrl||(t.editTemplateUrl=d+"widget-edit.html",i.editTemplateUrl&&(t.editTemplateUrl=i.editTemplateUrl)),t.titleTemplateUrl||(t.frameless=i.frameless),t.styleClass||(t.styleClass=i.styleClass),t.wid||(t.wid=l.id()),e.widget=angular.copy(i);var o=t.config;o?angular.isString(o)&&(o=angular.fromJson(o)):o={},e.config=o,"undefined"==typeof e.widget.show_modal_footer&&(e.widget.show_modal_footer=!0),"undefined"==typeof e.widget.show_reload_config&&(e.widget.show_reload_config=!0),e.widgetState||(e.widgetState={},e.widgetState.isCollapsed=i.collapsed===!0&&i.collapsed)}else n.warn("could not find widget "+t.type)}else n.debug("definition not specified, widget was probably removed")}function u(t,r){var l=t.definition;if(!l)return void n.debug("widget not found");var g=t.config||{},u=function(){r.remove(),a.$broadcast("adfWidgetRemovedFromGrid",l)};t.remove=function(){if(t.options.enableConfirmDelete){var e=t.$new(),i=d+"widget-delete.html";l.deleteTemplateUrl&&(i=l.deleteTemplateUrl);var n={scope:e,templateUrl:i,backdrop:"static"},a=o.open(n);e.closeDialog=function(){a.close(),e.$destroy()},e.deleteDialog=function(){u(),e.closeDialog()}}else u()},t.print=function(){t.editMode||t.$broadcast("widgetPrint")},t.isExecuteOperationEnabled=function(){if(g.entityKey)return!0;var e=g.filter;if(e){if(e.headersFilter&&e.headersFilter.length>0)return!0;if("basic"===e.type)return e.value&&e.value.length>0;if("advanced"===e.type)return e.value&&e.value.length>2&&e.oql}return!1},t.executeOperation=function(){t.editMode||t.$parent.$broadcast("widgetExecuteOperation")},p("init",t),t.launchSearching=function(){if(t.widget&&!t.widget.preventRefreshFilterEvent){var e={definition:l,element:r};a.$broadcast("adfLaunchSearchingFromWidget",e,t.config.filter)}t.reload()},t.launchSearchingAdv=function(){if(!t.filterApplied){var e=!0;t.search.quick="",""===t.search.json||"{}"===t.search.json||!angular.isString(t.search.json)&&0===Object.keys(t.search.json).length?t.search.oql&&t.search.oql.trim().length>0?(s.error(f.instant("TOASTR.FILTER_IS_MALFORMED")),e=!1):t.config.filter={type:"advanced",oql:"",value:""}:t.config.filter={type:"advanced",oql:t.search.oql,value:t.search.json,headersFilter:t.config.filter.headersFilter},e&&(t.launchSearching(),t.filterApplied=!0)}},t.launchSearchingQuick=function(){t.filterApplied||(t.search||(t.search={}),t.search.oql=t.search.json="",t.config.filter={type:"basic",value:t.search.quick,headersFilter:t.config.filter.headersFilter},t.launchSearching(),t.filterApplied=!0)},t.launchSearchingShared=function(){var e=t.search.id;e?(e.filter.id=e.wid,t.config.filter=e.filter):t.config.filter={},t.launchSearching(),t.filterApplied=!0},t.filterSharedSelect=function(e,i){t.filterApplied=!1,t.launchSearchingShared()},t.filterSharedRemove=function(e,i){t.filterApplied=!1},t.enter=function(e){var i=e.keyCode?e.keyCode:e.which;13===i?(0===t.filter.typeFilter&&t.launchSearchingAdv(),1===t.filter.typeFilter&&t.launchSearchingQuick(),2===t.filter.typeFilter&&t.launchSearchingShared()):19===i?t.filter.showFinalFilter=!t.filter.showFinalFilter:t.filterApplied=!1},t.customSelectors=[],t.getCustomSelectors=function(){t.config.customSelectors?t.customSelectors=t.config.customSelectors:g.widgetSelectors().findFields("").then(function(e){t.customSelectors=e,t.$apply()})["catch"](function(e){n.error(e)})},t.changeDirection=function(){var e=g.sort.direction;"DESCENDING"===e?t.config.sort.direction="ASCENDING":"ASCENDING"===e&&(t.config.sort.direction="DESCENDING"),t.reload()},t.debugQuery=function(){c.parseQuery(t.search.oql||"").then(function(e){t.search.json=angular.toJson(e.filter,null,4),t.unknownWords="",t.filter_error=null})["catch"](function(e){t.filter_error=e})},t.autocomplete_options=function(){var e={suggest:c.suggest_field_delimited,customSelectors:g.widgetSelectors()};return e},t.selectedItems=l.selectedItems||{},t.selectionManager={currentSelection:t.selectedItems,isSelected:function(e,i){return t.selectedItems[e]&&!angular.isUndefined(i)&&(t.selectedItems[e].data=i),!!t.selectedItems[e]},totalSelected:function(){return Object.keys(t.selectedItems).length}},l.config.sendSelection&&(t.sendEntities=function(){l.config.sendSelection(t.selectedItems),t.$parent.closeDialog()},l.config.selectedItems&&(t.selectedItems=angular.copy(l.config.selectedItems)),t.config.selectionManager=t.selectionManager),t.manageSelectedItems=function(){var e=t.$new();l.config.sendSelection&&(delete g.selectionConfig.operationTypes,delete g.selectionConfig.filterTypes),e.selectionConfig=g.selectionConfig,e.selectedItems=[],angular.forEach(t.selectedItems,function(t,i){e.selectedItems.push({key:i,value:t})}),e.currentSelection={selected:e.selectedItems};var i=d+"widget-selection.html",n={scope:e,templateUrl:i,backdrop:"static",size:"lg",animation:!0},a=o.open(n);e.restoreSelection=function(){e.currentSelection={selected:e.selectedItems}},e.clearSelection=function(){e.currentSelection.selected=[]},e.applyFilter=function(i){var n=e.selectionConfig.filterAction(e.currentSelection.selected,i);angular.isUndefined(n)||null===n||(t.filter.typeFilter=0,c.parseQuery(n).then(function(e){t.search.oql=n,t.search.json=angular.toJson(e.filter,null,4),t.unknownWords="",t.filter_error=null,t.launchSearchingAdv()})["catch"](function(e){t.filter_error=e}))},e.executeOperation=function(i){t.editMode||t.$parent.$broadcast("widgetExecuteOperation",{selectedItems:e.currentSelection.selected,type:i})},e.saveChangesDialog=function(){var i={};angular.forEach(e.currentSelection.selected,function(e,t){i[e.key]={data:e.value.data,visible:e.value.visible}}),t.selectedItems=angular.copy(i),t.selectedItemsLength=Object.keys(t.selectedItems).length,t.selectionManager.lastItem={},t.$broadcast("widgetSelectionChanged",t.selectionManager),a.close(),e.$destroy()},e.closeDialog=function(){a.close(),e.$destroy()}},t.edit=function(){function n(e){var t;if("boolean"==typeof e){var n=i.defer();e?n.resolve():n.reject(),t=n.promise}else t=i.when(e);return t}var a=t.$new();a.definition=angular.copy(l);var r=d+"widget-edit.html";l.editTemplateUrl&&(r=l.editTemplateUrl);var c={scope:a,templateUrl:r,backdrop:"static",size:"lg"},s=o.open(c);a.closeDialog=function(){s.close(),a.$destroy()},a.saveDialog=function(){a.validationError=null;var i,o=t.widget;i=o.edit?o.edit.apply:function(){return!0};var r=a.definition.config||{},d={widget:o,definition:a.definition,config:r},c=e.invoke(i,i,d);n(c).then(function(){l.title=a.definition.title,"summaryChart"===a.definition.type&&("ENTITIES_VALUES"===a.definition.config.type?(a.definition.Ftype="entities",l.Ftype="entities"):(a.definition.Ftype=a.definition.config.type.toLowerCase(),l.Ftype=a.definition.config.type.toLowerCase())),angular.extend(l.config,r),a.closeDialog(),o.edit&&o.edit.reload&&(t.setReloadTimeout(),t.$broadcast("widgetConfigChanged"))},function(e){e?a.validationError=e:a.validationError="VALIDATION_DURING_APPLY_FAILED"})}}}var p=function(e,t){var i=t.config||{},n=i.filter=i.filter?i.filter:{},o=n.id=e&&n.id;switch(n.headersFilter=e&&n.headersFilter,t.filter||(t.filter={}),n.type){case"advanced":t.filter.typeFilter=o?2:0,t.search={oql:n.oql,json:n.value};break;case"basic":t.filter.typeFilter=o?2:1,t.search={quick:n.value};break;default:t.filter.typeFilter=o?2:1,t.search={quick:n.value=""}}t.search.id=e};return{replace:!0,restrict:"EA",transclude:!1,templateUrl:d+"widget-grid.html",scope:{definition:"=",editMode:"=",options:"=",widgetState:"="},controller:["$scope","$element",function(e,i){e.filter={typeFilter:1,showFilter:!1,showFinalFilter:!1};var d=e.$on("onWindowTimeChanged",function(t,n){e.config.windowFilter=n?n:config.windowFilter?{}:n;var o={definition:c,element:i};a.$broadcast("adfWindowTimeChangedFromWidget",o,e.config.windowFilter),e.$broadcast("widgetWindowTimeChanged",e.config.windowFilter),e.reload()});this.updateWidgetFilters=function(t,i){if(e.options&&e.options.extraData&&e.options.extraData.widgetFilters){var n,o=e.options.extraData.widgetFilters,a=e.definition,r=o.filter(function(e){var i=!(e.filter&&e.filter.id||e.Ftype!==a.Ftype||e.wid===a.wid);return i&&t===e.wid&&(n=e),i});e.sharedFilters=angular.copy(r),(!i||!n&&t)&&p(n,e)}};var c=e.definition;c.config.selectedItems&&(e.selectedItemsLength=Object.keys(c.config.selectedItems).length),e.navOptionsHandler={firstLoad:!0,loadingData:!1,startLoading:function(){e.navOptionsHandler.loadingData=!0},stopLoading:function(){e.navOptionsHandler.firstLoad=!1,e.navOptionsHandler.loadingData=!1,e.navOptionsHandler.lastMessageTime=new Date},setStatusMessage:function(t){e.navOptionsHandler.statusMessage=t,e.navOptionsHandler.lastMessageTime=new Date}},e.filterHandler={changeFilter:function(t,i,n){e.search=i,e.filter.typeFilter=n}},e.widgetActionsHandler={actions:[],setActions:function(t){e.widgetActionsHandler.actions=t}};var s=e.$on("adfDashboardCollapseExpand",function(t,i){e.widgetState.isCollapsed=i.collapseExpandStatus}),f=e.$on("adfWidgetEnterEditMode",function(t,i){l.idEquals(c.wid,i.wid)&&e.edit()}),g=e.$on("adfIsEditMode",function(t,i){e.editing=!0}),u=e.$on("adfDashboardChanged",function(t,i,n){var o=[],a=n.grid;if(a&&a.length>0){a.forEach(function(e){var t=e.definition;o.push(t.wid)});var r=e.options&&e.options.extraData&&e.options.extraData.widgetFilters,l=r.filter(function(e){var t=e.filter;return t&&!t.id||o.indexOf(t.id)!==-1});e.sharedFilters=angular.copy(l),e.editing=!1,e.$broadcast("widgetConfigChanged",o)}}),m=e.$on("adfDashboardEditsCancelled",function(t,i){e.editing=!1});e.openFullScreen=function(){var t=document.getElementsByClassName("widget widget_"+e.definition.wid);t[0].requestFullscreen?(t[0].requestFullscreen(),e.$broadcast("OnResizeWidget")):t[0].mozRequestFullScreen?(t[0].mozRequestFullScreen(),e.$broadcast("OnResizeWidget")):t[0].webkitRequestFullscreen?(t[0].webkitRequestFullscreen(),e.$broadcast("OnResizeWidget")):t[0].msRequestFullscreen?(t[0].msRequestFullscreen(),e.$broadcast("OnResizeWidget")):e.$emit("adfOpenModalWidgetFromOther",c.type,e.config||{},e)},e.openAboutScreen=function(t){t="md";var i=o.open({animation:!0,templateUrl:"widgetAboutModal.html",controller:["$scope","$uibModalInstance","information",function(e,t,i){e.about={},e.about.info=i,e.ok=function(){t.close()}}],size:t,resolve:{information:function(){return e.config.about}}});i.result.then(function(t){e.selected=t},function(){n.info("Modal dismissed at: "+new Date)})},e.saveWidgetScreen=function(t){e.$emit("generateSnapshot",{objectSelector:".widget_"+t,fileName:"capture_"+(new Date).getTime()})},e.moveWidgetToDashboard=function(t,i){e.$emit("ouxWidget-move",{objectSelector:".widget_"+t},t)},e.copyWidgetToDashboard=function(t){e.$emit("ouxWidget-copy",{objectSelector:".widget_"+t},t)};var h=function(t){var i,n={or:[]};return t.forEach(function(t){i={},i[t.operator]={},i[t.operator][t.name]=e.config.filter.value,n.or.push(i)}),n};e.downloadCsv=function(){var i,n=e.config.columns,o=e.config.filter,a={},r=e.config.sort?e.config.sort:t;if(e.config.windowFilter){var l=e.config.onWindowTimeChanged(e.config.windowFilter);l&&l.and&&(i={and:l.and})}var d;o.type&&"advanced"===o.type&&o.value.length>4?d=JSON.parse(o.value):o.type&&"basic"===o.type&&""!==o.value.trim()&&(d=h(e.config.fieldsQuickSearch,o.value)),a=i?d?{and:[i,d]}:i:d,e.$broadcast("downloadCsv",{columns:n,filter:a,order:r})},e.generateQR=function(){e.$broadcast("generateQR")};var v,w=e.$on("addItemToSelection",function(t,i){e.selectedItems[i.key]||(e.selectedItems[i.key]={data:i.data,visible:i.visible},e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!0,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))}),b=e.$on("removeItemFromSelection",function(t,i){e.selectedItems[i.key]&&(delete e.selectedItems[i.key],e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!1,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))});e.setReloadTimeout=function(){var i=e.config||e.definition.config||{},n=i.reloadPeriod;isNaN(n)||1*n===0?v&&r.cancel(v):(angular.isDefined(v)&&(r.cancel(v),v=t),v=r(e.reload,1e3*n))},e.reload=function(){e.$broadcast("widgetReload"),e.setReloadTimeout()},e.setReloadTimeout(),e.$on("$destroy",function(){s(),f(),g(),u(),m(),w(),b(),d(),r.cancel(v)})}],compile:function(){return{pre:g,post:u}}}}]),angular.module("adf").factory("widgetService",["$http","$q","$sce","$templateCache","dashboard",function(e,t,i,n,o){function a(e){var t=e;return e.indexOf("{widgetsPath}")>=0&&(t=e.replace("{widgetsPath}",o.widgetsPath).replace("//","/"),0===t.indexOf("/")&&(t=t.substring(1))),t}var r={};return r.getTemplate=function(o){var r=t.defer();if(o.template)r.resolve(o.template);else if(o.templateUrl){var l=n.get(o.templateUrl);if(l)r.resolve(l);else{var d=i.getTrustedResourceUrl(a(o.templateUrl));e.get(d).success(function(e){n.put(o.templateUrl,e),r.resolve(e)}).error(function(){r.reject("could not load template")})}}return r.promise},r}])}(window);
//# sourceMappingURL=opengate-angular-dashboard-framework.min.js.map
