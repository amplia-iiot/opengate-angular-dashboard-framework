!function(e,t){"use strict";angular.module("adf",["adf.provider","ui.bootstrap","opengate-angular-js"]).value("adfTemplatePath","../src/templates/").value("columnTemplate",'<adf-dashboard-column column="column" adf-model="adfModel" options="options" edit-mode="editMode" ng-repeat="column in row.columns" />').value("adfVersion","5.1.0"),angular.module("adf").directive("adfDashboard",["$rootScope","$log","$timeout","$uibModal","dashboard","adfTemplatePath","$faIcons","$translate",function(e,t,i,n,o,a,r,d){function l(e){switch(angular.isDefined(e)?e.toLowerCase():null){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function c(e){var t={},i=o.widgets[e].config;return i&&(t=angular.copy(i)),t}function s(e){var t={},i=o.widgets[e];return i&&(t=angular.copy(i)),t}function f(i,n,o,a){if(i){i.grid||(i.grid=[]);var r={width:3,height:2,x:0,y:0,definition:n};i.grid.push(r),e.$broadcast("adfWidgetAdded",o,i,n),a&&e.$broadcast("adfDashboardChanged",o,i)}else t.error("model is undefined")}function u(e){var t=o.widgets[e];return t&&t.edit&&t.edit.immediate}function g(e,t){i(function(){e.$broadcast("adfWidgetEnterEditMode",t)},200)}function p(e){var t={};return angular.forEach(e,function(e,i){var n=e.category;n||(n="ADF.CATEGORY.MISCELANOUS"),e.title=d.instant(e.title),e.description=d.instant(e.description),e.category=d.instant(e.category),angular.isUndefined(t[e.category])&&(t[e.category]={widgets:{}}),t[e.category].widgets[i]=e}),t}function m(e){var t=[];return angular.forEach(e,function(e,i){e.category||(e.category="ADF.CATEGORY.MISCELLANEOUS"),e.title=d.instant(e.title),e.description=d.instant(e.description),e.category=d.instant(e.category),e.categoryTags||(e.categoryTags="ADF.CATEGORY.TAG.MISCELLANEOUS");var n=e.categoryTags.split(",");angular.forEach(n,function(e,i){var n=d.instant(e);t.indexOf(n)===-1&&t.push(n)})}),t}return{replace:!0,restrict:"EA",transclude:!1,scope:{name:"@",collapsible:"@",editable:"@",editMode:"@",continuousEditMode:"=",maximizable:"@",adfModel:"=",adfWidgetFilter:"=",categories:"@",hideButtons:"=",extraData:"="},controller:["$scope",function(i){function l(){var e=i.$new();return e}var h={},v=null,w=i.name,b=function(e){var t=[],n=e.grid;n&&n.length>0&&n.forEach(function(e){var i=e.definition,n=i.config;t.push({wid:i.wid,title:i.title,filter:n.filter,Ftype:i.Ftype})}),i.options||(i.options={extraData:{}}),i.options.extraData.widgetFilters=t};i.$watch("adfModel",function(e,n){(null!==n||null===e&&null===n)&&(h=i.adfModel,v=i.adfWidgetFilter,h?(b(h),h.title||(h.title=d.instant("ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD")),h.titleTemplateUrl||(h.titleTemplateUrl=a+"dashboard-title.html"),i.model=h):t.error("could not find or create model"))},!0),i.editMode=!1,i.toggleEditMode=function(t){i.editMode=!i.editMode,i.editMode&&(i.continuousEditMode||(i.modelCopy=angular.copy(i.adfModel,{}),e.$broadcast("adfIsEditMode")),t&&i.editDashboardDialog()),i.editMode||e.$broadcast("adfDashboardChanged",w,h)};var y=i.$on("adfToggleEditMode",function(e,t){t?i.toggleEditMode(!0):i.toggleEditMode()}),$=i.$on("adfCancelEditMode",function(e){i.editMode&&i.cancelEditMode()}),S=i.$on("adfWidgetRemovedFromGrid",function(e,t){var n=null;angular.forEach(i.adfModel.grid,function(e,i){e.definition.wid===t.wid&&(n=i)}),n>=0&&i.adfModel.grid.splice(n,1)});i.cancelEditMode=function(){i.editMode=!1,i.continuousEditMode||i.modelCopy===i.adfModel||(i.modelCopy=angular.copy(i.modelCopy,i.adfModel)),e.$broadcast("adfDashboardEditsCancelled")};var D=i.$on("adfEditDashboardDialog",function(e){i.editMode&&i.editDashboardDialog()}),M=i.$on("adfLaunchSearchingFromWidget",function(t,i){var n=[];if(i){var o=angular.copy(i.definition),a=o.wid,r=o.config;if(r){var d=r.filter;h.grid.forEach(function(e){var t=e.definition.config.filter;t&&t.id&&t.id===a&&(e.definition.config.filter=d,e.definition.config.filter.id=a,n.push(e.definition.wid))})}}e.$broadcast("adfFilterChanged",w,h,n)}),E=i.$on("adfWindowTimeChangedFromWidget",function(t){e.$broadcast("adfFilterChanged",w,h)});i.editDashboardDialog=function(){var e=l();e.copy={title:"ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD"!==h.title?h.title:"",description:h.description,icon:h.icon?h.icon:"fa-tachometer"},e.availableIcons=r.list();var t=a+"dashboard-edit.html";h.editTemplateUrl&&(t=h.editTemplateUrl);var i=n.open({scope:e,templateUrl:t,backdrop:"static",keyboard:!1,size:"lg"});e.closeDialog=function(){h.title=e.copy.title,h.description=e.copy.description,h.icon=e.copy.icon,i.close(),e.$destroy()}};var T=i.$on("adfOpenWidgetFromOther",function(e,t,n){var o=c(t),a=angular.merge({},o,n),r={type:t,config:a,title:a.title};f(h,r,w,!i.editMode)}),C=i.$on("adfOpenModalWidgetFromOther",function(t,o,r){var d=a+"widget-fullscreen.html";r.sendSelection&&(d=a+"widget-fullscreen-selection.html");var l=s(o);l.config=angular.merge({},l.config,r),l.type=o,l.config.title&&(l.title=l.config.title);var c=i.$new();c.definition=c.widget=l;var f={scope:c,templateUrl:d,size:c.definition.modalSize||"el",backdrop:"static",windowClass:c.definition.fullScreen?"dashboard-modal widget-fullscreen":"dashboard-modal"};i.model&&!i.model.temporal&&(c.persistDashboard=function(){e.$broadcast("adfOpenWidgetFromOther",this.$parent.widget.type,this.$parent.widget.config),this.closeDialog()});var u=n.open(f);c.closeDialog=function(){u.close(),c.$destroy()}}),F=i.$on("adfAddWidgetDialog",function(t){!h.temporal&&h.editable&&(i.editMode||(i.editMode=!0,i.modelCopy=angular.copy(i.adfModel,{}),e.$broadcast("adfIsEditMode")),i.addWidgetDialog())});i.addScopeCfg={widgetFilter:{},widgetSortingDirection:"",widgetSorting:"priority"},i.addWidgetDialog=function(){var e,t=l();angular.isFunction(v)?(e={},angular.forEach(o.widgets,function(t,i){v(t,i,h)&&(e[i]=t)})):e=o.widgets,t.widgets=e,angular.forEach(t.widgets,function(e,t){e.key=t,e.category||(e.category="Miscellaneous")}),i.options.categories?t.createCategories=p:t.availableCategories=m(e);var r=a+"widget-add.html";h.addTemplateUrl&&(r=h.addTemplateUrl);var d={scope:t,templateUrl:r,backdrop:"static",size:"lg"},s=n.open(d);t.widgetFilterCfg=i.addScopeCfg,t.addWidget=function(e){var n={type:e,Ftype:o.widgets[e].Ftype||null,config:c(e)};f(h,n,w),s.close(),t.$destroy(),u(e)&&g(i,n)},t.changeThumbnail=function(e){e.images&&(angular.isUndefined(e._currThumb)?e._currThumb=1:e._currThumb+=1,e._currThumb>=e.images.length&&(e._currThumb=0),e._currImg=e.images[e._currThumb])},t.closeDialog=function(){s.close(),t.$destroy()}},i.addNewWidgetToModel=f,i.$on("destroy",function(){M(),E(),y(),T(),C(),$(),F(),D(),S()})}],link:function(e,t,i){var n={name:i.name,editable:!0,enableConfirmDelete:l(i.enableConfirmDelete),maximizable:l(i.maximizable),collapsible:l(i.collapsible),categories:l(i.categories),extraData:{}};angular.isDefined(i.editable)&&(n.editable=l(i.editable)),angular.isDefined(e.extraData)&&(n.extraData=e.extraData),n.extraData.editing=e.editMode,e.options=n},templateUrl:a+"dashboard.html"}}]),angular.module("adf").directive("adfDashboardGrid",["adfTemplatePath",function(e){function t(e){e.gridOptions={cellHeight:146,verticalMargin:10,animate:!0,"float":!1,alwaysShowResizeHandle:!0,minWidth:768,auto:!0,resizable:{handles:"e, se, s, sw, w"},disableDrag:!e.editMode,disableResize:!e.editMode},e.gsHandler=null}return{restrict:"E",scope:{adfModel:"=",editMode:"=",continuousEditMode:"=",options:"="},templateUrl:e+"dashboard-grid.html",compile:function(){return{pre:t}},controller:["$scope","$timeout",function(e,t){var i=[];i.push(e.$on("adfIsEditMode",function(){t(function(){e.gsHandler.enable()},100)})),i.push(e.$on("adfDashboardChanged",function(){t(function(){e.gsHandler.disable()},100)})),i.push(e.$on("adfDashboardEditsCancelled",function(){t(function(){e.gsHandler.disable()},100)})),i.push(e.$on("adfCancelEditMode",function(){t(function(){e.gsHandler.disable()},100)})),i.push(e.$on("adfWidgetAdded",function(i){t(function(){e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.gsHandler.enable()},100)})),e.onChange=function(t,i){console.log("onChange event: "+t+" items:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onDragStart=function(e,t){console.log("onDragStart event: "+e+" ui:"+t)},e.onDragStop=function(t,i){console.log("onDragStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onResizeStart=function(e,t){console.log("onResizeStart event: "+e+" ui:"+t)},e.onResizeStop=function(t,i){console.log("onResizeStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.$broadcast("OnResizeWidget")},e.onItemAdded=function(e){console.log("onItemAdded item: "+e)},e.onItemRemoved=function(e){console.log("onItemRemoved item: "+e)},e.$on("destroy",function(){i.forEach(function(e){e()})})}]}}]),angular.module("adf").filter("adfOrderByObjectKey",["$filter",function(e){return function(t,i){var n=[];return angular.forEach(t,function(e,t){e[i]=t,n.push(e)}),e("orderBy")(n,i)}}]),angular.module("adf.provider",[]).provider("dashboard",function(){var e={},t="",i='<div class="alert alert-primary">{}</div>',n='      <div class="progress progress-striped active">\n        <div class="progress-bar" role="progressbar" style="width: 100%">\n          <span class="sr-only" translate>FORM.MSG.LOADING ...</span>\n        </div>\n      </div>',o=null,a=function(){return!0};this.widget=function(t,i){var n=angular.extend({reload:!1,frameless:!1},i);if(n.edit){var o={reload:!0,immediate:!1,apply:a};angular.extend(o,n.edit),n.edit=o}return e[t]=n,this},this.widgetsPath=function(e){return t=e,this},this.messageTemplate=function(e){return i=e,this},this.loadingTemplate=function(e){return n=e,this},this.customWidgetTemplatePath=function(e){return o=e,this},this.$get=function(){var a=0;return{widgets:e,widgetsPath:t,messageTemplate:i,loadingTemplate:n,customWidgetTemplatePath:o,id:function(){return(new Date).getTime()+"-"+ ++a},idEquals:function(e,t){return e&&t&&e.toString()===t.toString()}}}}),angular.module("adf").directive("adfWidgetContent",["$log","$q","widgetService","$compile","$controller","$injector","dashboard","$translate",function(i,n,o,a,r,d,l,c){function s(e,t){i.warn(t),e.html(l.messageTemplate.replace(/{}/g,t))}function f(i,n,o,a){function r(t){if("custom"===t)return{from:g.config.windowFilter.from,to:g.config.windowFilter.to};var i=e.moment().subtract(1,t);return{from:i._d}}var d=i.model;if(!d)return c("ADF.ERROR.MODEL_IS_UNDEFINED").then(function(e){s(n,e)}),o;var l=i.content;if(!l)return c("ADF.ERROR.WIDGET_FOR_DEPRECTATED",{title:d.title}).then(function(e){s(n,e)}),o;var f=i.extra,g=o;if(g){var p=!(g.menu===t||null===g.menu||g.isPaginationEnable&&g.isPaginationEnable());if(p||a||!angular.isFunction(g.reloadData))i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),g=u(i,n,o,d,l,f);else{var m=g.itemsPerPage!==t&&null!==g.itemsPerPage;(m||g.page)&&(g.page=1),g.reloadData()}}else i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),g=u(i,n,o,d,l,f);return g.config&&(g.config.getWindowTime=function(){var t=g.config.windowFilter;if(t&&t.type){var i=r(t.type);if(!e.eval(g.config.windowFilter.rawdate)){for(var n in i)i[n]=e.moment(i[n]).format();i.rawdate=!0}return i}}),f&&(g.editing=!!f.editing,g.extraData=f),g}function u(e,i,f,u,g,p){i.html(l.loadingTemplate);var m=e.$new();u.config||(u.config={}),m.config=u.config,m.editing=p&&p.editing,p&&(m.extra=p);var h=f||m.config;m.selectionManager=h?h.selectionManager:t;var v={$scope:m,widget:u,config:u.config},w={};return w.$tpl=o.getTemplate(g),g.resolve&&angular.forEach(g.resolve,function(e,t){angular.isString(e)?w[t]=d.get(e):w[t]=d.invoke(e,e,v)}),n.all(w).then(function(e){angular.extend(e,v),g.resolveAs&&(m[g.resolveAs]=e);var t=e.$tpl;if(i.html(t),g.controller){var n=r(g.controller,e);g.controllerAs&&(m[g.controllerAs]=n),i.children().data("$ngControllerController",n)}a(i.contents())(m)},function(e){var t="ADF.ERROR.COULD_NOT_RESOLVE_ALL_PROMISSES";c(t,{reason:e?": "+e:e}).then(function(e){s(i,e)})}),f&&f.$destroy(),m}return{replace:!0,restrict:"EA",transclude:!1,require:"?^^adfWidgetGrid",scope:{model:"=",content:"=",extra:"=",navOptionsHandler:"=?",filterHandler:"=?",widgetActionsHandler:"=?"},link:function(e,t,i,n){var o=f(e,t,null);n&&(e.search=e.search||{},n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id));var a=e.$on("widgetConfigChanged",function(){o=f(e,t,o,!0)}),r=e.$on("widgetReload",function(i,a){var r=!0;a&&a.length>0&&(r=a.indexOf(e.model.wid)!==-1),r&&(o=f(e,t,o,!1),n&&n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id))});e.$on("destroy",function(){a(),r()})}}}]),angular.module("adf").directive("adfWidgetGrid",["$injector","$q","$log","$uibModal","$rootScope","$interval","dashboard","adfTemplatePath","Filter",function(e,i,n,o,a,r,d,l,c){function s(e){var t=e.definition;if(t){var i=d.widgets[t.type];if(i){t.title||(t.title=i.title),t.titleTemplateUrl=l+"widget-grid-title.html",t.editTemplateUrl||(t.editTemplateUrl=l+"widget-edit.html",i.editTemplateUrl&&(t.editTemplateUrl=i.editTemplateUrl)),t.titleTemplateUrl||(t.frameless=i.frameless),t.styleClass||(t.styleClass=i.styleClass),t.wid||(t.wid=d.id()),e.widget=angular.copy(i);var o=t.config;o?angular.isString(o)&&(o=angular.fromJson(o)):o={},"undefined"==typeof e.widget.show_modal_footer&&(e.widget.show_modal_footer=!0),"undefined"==typeof e.widget.show_reload_config&&(e.widget.show_reload_config=!0),e.config=o,e.widgetState||(e.widgetState={},e.widgetState.isCollapsed=i.collapsed===!0&&i.collapsed)}else n.warn("could not find widget "+t.type)}else n.debug("definition not specified, widget was probably removed")}function f(t,r){var d=t.definition;if(!d)return void n.debug("widget not found");t.config||(t.config={});var s=t.config,f=function(){r.remove(),a.$broadcast("adfWidgetRemovedFromGrid",d)};t.remove=function(){if(t.options.enableConfirmDelete){var e=t.$new(),i=l+"widget-delete.html";d.deleteTemplateUrl&&(i=d.deleteTemplateUrl);var n={scope:e,templateUrl:i,backdrop:"static"},a=o.open(n);e.closeDialog=function(){a.close(),e.$destroy()},e.deleteDialog=function(){f(),e.closeDialog()}}else f()},t.print=function(){t.editMode||t.$broadcast("widgetPrint")},t.isExecuteOperationEnabled=function(){if(s.entityKey)return!0;var e=s.filter;return e&&"basic"===e.type?e.length>0:!(!e||"advanced"!==e.type)&&(e.value.length>2&&e.oql)},t.executeOperation=function(){t.editMode||t.$parent.$broadcast("widgetExecuteOperation")},t.filter={typeFilter:1,showFilter:!1,showFinalFilter:!1};var u=s.filter=s.filter?s.filter:{};switch(u.type){case"advanced":t.search={oql:u.oql,json:u.value,id:u.id},t.filter.typeFilter=u.id?2:0;break;case"basic":t.search={quick:u.value,id:u.id},t.filter.typeFilter=u.id?2:1;break;default:t.search={quick:u=""}}t.launchSearching=function(){var e={definition:d,element:r};a.$broadcast("adfLaunchSearchingFromWidget",e,t.config.filter),t.reload(!0)},t.launchSearchingAdv=function(){t.filterApplied||(t.search.quick="",""===t.search.json||"{}"===t.search.json||!angular.isString(t.search.json)&&0===Object.keys(t.search.json).length?t.config.filter={oql:"",value:""}:t.config.filter={type:"advanced",oql:t.search.oql,value:t.search.json},t.launchSearching(),t.filterApplied=!0)},t.launchSearchingQuick=function(){t.filterApplied||(t.search.oql=t.search.json="",t.config.filter={type:"basic",value:t.search.quick},t.launchSearching(),t.filterApplied=!0)},t.launchSearchingShared=function(){if(!t.filterApplied){var e=t.search.id;e?(e.filter.id=e.wid,t.config.filter=e.filter):t.config.filter={},t.launchSearching(),t.filterApplied=!0}},t.filterSharedSelect=function(e,i){t.filterApplied=!1},t.filterSharedRemove=function(e,i){t.filterApplied=!1};t.$on("onWindowTimeChanged",function(e,i){t.config.windowFilter=i?i:s.windowFilter?{}:i;var n={definition:d,element:r};a.$broadcast("adfWindowTimeChangedFromWidget",n,t.config.windowFilter),t.reload()});t.enter=function(e){var i=e.keyCode?e.keyCode:e.which;13===i?(0===t.filter.typeFilter&&t.launchSearchingAdv(),1===t.filter.typeFilter&&t.launchSearchingQuick()):19===i?t.filter.showFinalFilter=!t.filter.showFinalFilter:t.filterApplied=!1},t.customSelectors=[],t.getCustomSelectors=function(){t.config.customSelectors?t.customSelectors=t.config.customSelectors:s.widgetSelectors().findFields("").then(function(e){t.customSelectors=e,t.$apply()})["catch"](function(e){n.error(e)})},t.changeDirection=function(){var e=s.sort.direction;"DESCENDING"===e?t.config.sort.direction="ASCENDING":"ASCENDING"===e&&(t.config.sort.direction="DESCENDING"),t.reload()},t.debugQuery=function(){c.parseQuery(t.search.oql||"").then(function(e){t.search.json=angular.toJson(e.filter,null,4),t.unknownWords="",t.filter_error=null})["catch"](function(e){t.filter_error=e})},t.autocomplete_options=function(){var e={suggest:c.suggest_field_delimited,customSelectors:s.widgetSelectors()};return e},t.selectedItems=d.selectedItems||{},t.selectionManager={currentSelection:t.selectedItems,isSelected:function(e,i){return t.selectedItems[e]&&!angular.isUndefined(i)&&(t.selectedItems[e].data=i),!!t.selectedItems[e]},totalSelected:function(){return Object.keys(t.selectedItems).length}},d.config.sendSelection&&(t.sendEntities=function(){d.config.sendSelection(t.selectedItems),t.$parent.closeDialog()},d.config.selectedItems&&(t.selectedItems=angular.copy(d.config.selectedItems)),t.config.selectionManager=t.selectionManager),t.manageSelectedItems=function(){var e=t.$new();d.config.sendSelection&&(delete s.selectionConfig.operationTypes,delete s.selectionConfig.filterTypes),e.selectionConfig=s.selectionConfig,e.selectedItems=[],angular.forEach(t.selectedItems,function(t,i){e.selectedItems.push({key:i,value:t})}),e.currentSelection={selected:e.selectedItems};var i=l+"widget-selection.html",n={scope:e,templateUrl:i,backdrop:"static",size:"lg",animation:!0},a=o.open(n);e.restoreSelection=function(){e.currentSelection={selected:e.selectedItems}},e.clearSelection=function(){e.currentSelection.selected=[]},e.applyFilter=function(i){var n=e.selectionConfig.filterAction(e.currentSelection.selected,i);angular.isUndefined(n)||null===n||(t.filter.typeFilter=0,c.parseQuery(n).then(function(e){t.search.oql=n,t.search.json=angular.toJson(e.filter,null,4),t.unknownWords="",t.filter_error=null,t.launchSearchingAdv()})["catch"](function(e){t.filter_error=e}))},e.executeOperation=function(i){t.editMode||t.$parent.$broadcast("widgetExecuteOperation",{selectedItems:e.currentSelection.selected,type:i})},e.saveChangesDialog=function(){var i={};angular.forEach(e.currentSelection.selected,function(e,t){i[e.key]={data:e.value.data,visible:e.value.visible}}),t.selectedItems=angular.copy(i),t.selectedItemsLength=Object.keys(t.selectedItems).length,t.selectionManager.lastItem={},t.$broadcast("widgetSelectionChanged",t.selectionManager),a.close(),e.$destroy()},e.closeDialog=function(){a.close(),e.$destroy()}},t.edit=function(){function n(e){var t;if("boolean"==typeof e){var n=i.defer();e?n.resolve():n.reject(),t=n.promise}else t=i.when(e);return t}var a=t.$new();a.definition=angular.copy(d);var r=l+"widget-edit.html";d.editTemplateUrl&&(r=d.editTemplateUrl);var c={scope:a,templateUrl:r,backdrop:"static",size:"lg"},s=o.open(c);a.closeDialog=function(){s.close(),a.$destroy()},a.saveDialog=function(){a.validationError=null;var i,o=t.widget;i=o.edit?o.edit.apply:function(){return!0};var r={widget:o,definition:a.definition,config:a.definition.config},l=e.invoke(i,i,r);n(l).then(function(){d.title=a.definition.title,"summaryChart"===a.definition.type&&(a.definition.Ftype=a.definition.config.type.toLowerCase(),d.Ftype=a.definition.config.type.toLowerCase()),angular.extend(d.config,a.definition.config),a.closeDialog(),o.edit&&o.edit.reload&&(t.setReloadTimeout(),t.$broadcast("widgetConfigChanged"))},function(e){e?a.validationError=e:a.validationError="VALIDATION_DURING_APPLY_FAILED"})}}}return{replace:!0,restrict:"EA",transclude:!1,templateUrl:l+"widget-grid.html",scope:{definition:"=",editMode:"=",options:"=",widgetState:"="},controller:["$scope",function(e){this.updateWidgetFilters=function(t){var i,n=e.options.extraData.widgetFilters,o=e.definition,a=n.filter(function(e){var n=e.wid!==o.wid&&e.Ftype===o.Ftype&&!e.filter.id;return n&&t===e.wid&&(i=e),n});e.sharedFilters=angular.copy(a),e.search.id=i};var i=e.definition;i.config.selectedItems&&(e.selectedItemsLength=Object.keys(i.config.selectedItems).length),e.navOptionsHandler={firstLoad:!0,loadingData:!1,startLoading:function(){e.navOptionsHandler.loadingData=!0},stopLoading:function(){e.navOptionsHandler.firstLoad=!1,e.navOptionsHandler.loadingData=!1,e.navOptionsHandler.lastMessageTime=new Date},setStatusMessage:function(t){e.navOptionsHandler.statusMessage=t,e.navOptionsHandler.lastMessageTime=new Date}},e.filterHandler={changeFilter:function(t,i,n){e.search=i,e.filter.typeFilter=n}},e.widgetActionsHandler={actions:[],setActions:function(t){e.widgetActionsHandler.actions=t}};var a=e.$on("adfDashboardCollapseExpand",function(t,i){e.widgetState.isCollapsed=i.collapseExpandStatus}),l=e.$on("adfWidgetEnterEditMode",function(t,n){d.idEquals(i.wid,n.wid)&&e.edit()}),c=e.$on("adfIsEditMode",function(t,i){e.editing=!0}),s=e.$on("adfDashboardChanged",function(t,i){e.editing=!1}),f=e.$on("adfDashboardEditsCancelled",function(t,i){e.editing=!1});e.openFullScreen=function(){e.$emit("adfOpenModalWidgetFromOther",i.type,e.config)},e.openAboutScreen=function(t){t="md";var i=o.open({animation:!0,templateUrl:"widgetAboutModal.html",controller:["$scope","$uibModalInstance","information",function(e,t,i){e.about={},e.about.info=i,e.ok=function(){t.close()}}],size:t,resolve:{information:function(){return e.config.about}}});i.result.then(function(t){e.selected=t},function(){n.info("Modal dismissed at: "+new Date)})},e.saveWidgetScreen=function(t){e.$emit("generateSnapshot",{objectSelector:".widget_"+t,fileName:"capture_"+(new Date).getTime()})};var u=function(t){var i,n={or:[]};return t.forEach(function(t){i={},i[t.operator]={},i[t.operator][t.name]=e.config.filter.value,n.or.push(i)}),n};e.downloadCsv=function(){var i,n=e.config.columns,o=e.config.filter,a={},r=e.config.sort?e.config.sort:t;if(e.config.windowFilter){var d=e.config.onWindowTimeChanged(e.config.windowFilter);d&&d.and&&(i={and:d.and})}var l;o.type&&"advanced"===o.type&&o.value.length>4?l=JSON.parse(o.value):o.type&&"basic"===o.type&&""!==o.value.trim()&&(l=u(e.config.fieldsQuickSearch,o.value)),a=i?l?{and:[i,l]}:i:l,e.$broadcast("downloadCsv",{columns:n,filter:a,order:r})},e.generateQR=function(){e.$broadcast("generateQR")};var g,p=e.$on("addItemToSelection",function(t,i){e.selectedItems[i.key]||(e.selectedItems[i.key]={data:i.data,visible:i.visible},e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!0,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))}),m=e.$on("removeItemFromSelection",function(t,i){e.selectedItems[i.key]&&(delete e.selectedItems[i.key],e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!1,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))});e.setReloadTimeout=function(){var i=e.config||e.definition.config;if(i){var n=i.reloadPeriod;isNaN(n)||1*n===0?g&&r.cancel(g):(angular.isDefined(g)&&(r.cancel(g),g=t),g=r(e.reload,1e3*n))}},e.reload=function(t){t?e.$broadcast("widgetReload",t):e.$broadcast("widgetReload"),e.setReloadTimeout()},e.setReloadTimeout(),e.$on("$destroy",function(){a(),l(),c(),s(),f(),p(),m(),r.cancel(g)})}],compile:function(){return{pre:s,post:f}}}}]),angular.module("adf").factory("widgetService",["$http","$q","$sce","$templateCache","dashboard",function(e,t,i,n,o){function a(e){var t=e;return e.indexOf("{widgetsPath}")>=0&&(t=e.replace("{widgetsPath}",o.widgetsPath).replace("//","/"),0===t.indexOf("/")&&(t=t.substring(1))),t}var r={};return r.getTemplate=function(o){var r=t.defer();if(o.template)r.resolve(o.template);else if(o.templateUrl){var d=n.get(o.templateUrl);if(d)r.resolve(d);else{var l=i.getTrustedResourceUrl(a(o.templateUrl));e.get(l).success(function(e){n.put(o.templateUrl,e),r.resolve(e)}).error(function(){r.reject("could not load template")})}}return r.promise},r}])}(window);
//# sourceMappingURL=opengate-angular-dashboard-framework.min.js.map
