!function(e,t){"use strict";angular.module("adf",["adf.provider","ui.bootstrap","opengate-angular-js"]).value("adfTemplatePath","../src/templates/").value("columnTemplate",'<adf-dashboard-column column="column" adf-model="adfModel" options="options" edit-mode="editMode" ng-repeat="column in row.columns" />').value("adfVersion","8.9.0"),angular.module("adf").directive("adfDashboard",["$rootScope","$log","$timeout","$uibModal","dashboard","adfTemplatePath","$translate","Upload",function(e,i,n,a,o,r,l,d){function c(e){switch(angular.isDefined(e)?e.toLowerCase():null){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function s(e){var t={},i=o.widgets[e].config||{};return t=angular.copy(i)}function u(e){var t={},i=o.widgets[e];return i&&(t=angular.copy(i)),t}function f(t,n,a,o){if(t){t.grid||(t.grid=[]);var r={width:3,height:2,x:0,y:0,definition:n};t.grid.push(r),e.$broadcast("adfWidgetAdded",a,t,n),o&&e.$broadcast("adfDashboardChanged",a,t)}else i.error("model is undefined")}function g(e){var t=o.widgets[e];return t&&t.edit&&t.edit.immediate}function m(e,t){n(function(){e.$broadcast("adfWidgetEnterEditMode",t)},200)}function p(e){var t={};return angular.forEach(e,function(e,i){var n=e.category;n||(n="ADF.CATEGORY.MISCELANOUS"),e.title=l.instant(e.title),e.description=l.instant(e.description),e.category=l.instant(e.category),angular.isUndefined(t[e.category])&&(t[e.category]={widgets:{}}),t[e.category].widgets[i]=e}),t}function h(e){var t=[];return angular.forEach(e,function(e,i){e.category||(e.category="ADF.CATEGORY.MISCELLANEOUS"),e.title=l.instant(e.title),e.description=l.instant(e.description),e.category=l.instant(e.category),e.categoryTags||(e.categoryTags="ADF.CATEGORY.TAG.MISCELLANEOUS");var n=e.categoryTags.split(","),a=[];angular.forEach(n,function(e,i){var n=l.instant(e);t.indexOf(n)===-1&&t.push(n),a.indexOf(n)===-1&&a.push(n)}),e.categoryTags=a.toString()}),t}return{replace:!0,restrict:"EA",transclude:!1,scope:{name:"@",collapsible:"@",editable:"@",editMode:"@",continuousEditMode:"=",maximizable:"@",adfModel:"=",adfWidgetFilter:"=",categories:"@",hideButtons:"=",extraData:"="},controller:["$scope",function(n){function c(){var e=n.$new();return e}var v={extraConfig:{cellHeight:145}},y=null,b=n.name,w=function(e){var t={configChange:[],reload:[]};if(e){var i=angular.copy(e.definition),n=i.Ftype,a=i.wid,o=i.config||{},r=o.filter;v.grid.forEach(function(e){var i=e.definition.config.filter,o=e.definition.Ftype;i&&i.id&&i.id===a?(e.definition.config.filter=r,e.definition.config.filter.id=a,t.reload.push(e.definition.wid)):n===o&&t.configChange.push(e.definition.wid)})}return t},S=function(e){var t=[],i=e.grid;i&&i.length>0&&i.forEach(function(e){var i=e.definition,n=i.config||{},a=n.filter;t.push({wid:i.wid,title:i.title,filter:a,Ftype:i.Ftype})}),n.options||(n.options={extraData:{}}),n.options.extraData.widgetFilters=t};n.$watch("adfModel",function(e,t){(null!==t||null===e&&null===t)&&(v=n.adfModel,y=n.adfWidgetFilter,v?(S(v),v.title||(v.title=l.instant("ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD")),v.titleTemplateUrl||(v.titleTemplateUrl=r+"dashboard-title.html"),v.extraConfig?v.extraConfig.cellHeight||(v.extraConfig.cellHeight=145):v.extraConfig={cellHeight:145},n.model=v):i.error("could not find or create model"))},!0),n.editMode=!1,n.toggleEditMode=function(t){n.editMode=!n.editMode,n.editMode&&(n.continuousEditMode||(n.modelCopy=angular.copy(n.adfModel,{}),e.$broadcast("adfIsEditMode")),t&&n.editDashboardDialog()),n.editMode||e.$broadcast("adfDashboardChanged",b,v)};var C=n.$on("adfToggleEditMode",function(e,t){t?n.toggleEditMode(!0):n.toggleEditMode()}),F=n.$on("adfCancelEditMode",function(e){n.editMode&&n.cancelEditMode()}),$=n.$on("adfWidgetRemovedFromGrid",function(e,t){var i=null;angular.forEach(n.adfModel.grid,function(e,n){e.definition.wid===t.wid&&(i=n)}),i>=0&&n.adfModel.grid.splice(i,1)}),D=n.$on("adfWidgetRemovedFromGridAndSave",function(e,t){var i=null;n.toggleEditMode(),angular.forEach(n.adfModel.grid,function(e,n){e.definition.wid===t.wid&&(i=n)}),i>=0&&n.adfModel.grid.splice(i,1),n.toggleEditMode()});n.cancelEditMode=function(){n.editMode=!1,n.continuousEditMode||n.modelCopy===n.adfModel||(n.modelCopy=angular.copy(n.modelCopy,n.adfModel)),e.$broadcast("adfDashboardEditsCancelled",n.adfModel.title,n.adfModel)};var T=n.$on("adfEditDashboardDialog",function(e){n.editMode&&n.editDashboardDialog()}),E=n.$on("adfLaunchSearchingFromWidget",function(t,i){var n=w(i);e.$broadcast("adfFilterChanged",b,v,n)}),M=n.$on("adfWindowTimeChangedFromWidget",function(t){e.$broadcast("adfFilterChanged",b,v)});n.editDashboardDialog=function(){var i=c();i.copy={title:"ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD"!==v.title?v.title:"",description:v.description,backgroundColor:v.backgroundColor?v.backgroundColor:t,time:new Date,backgroundImage:v.backgroundImage?v.backgroundImage:t,file:v.backgroundImage?v.backgroundImage:t,extraConfig:angular.copy(v.extraConfig)},i.backgroundSize={name:"backgroundSize",model:v.backgroundImageSize?v.backgroundImageSize:"100% 100%",options:{"100% 100%":{title:l.instant("SIZE_CONF.AUTO")},contain:{title:l.instant("SIZE_CONF.CONTAIN")},cover:{title:l.instant("SIZE_CONF.COVER")}}},i.iconConfiguration={name:"iconConfiguration",model:v.iconType?v.iconType:"icon",url:t,file:t,iconType:v.iconType?v.iconType:"icon",icon:"icon"===v.iconType?v.icon:"fa-tachometer",options:{icon:{title:l.instant("ICON.LIBRARY")},image:{title:l.instant("ICON.IMAGE")}}},"image"===i.iconConfiguration.iconType&&(i.iconConfiguration.file=v.icon,i.iconConfiguration.url=v.icon),i.imageSelected=function(e){e?(i.iconConfiguration.file=e,d.base64DataUrl(e).then(function(e){i.iconConfiguration.url=e,i.iconConfiguration.file=e,i.iconConfiguration.iconType="image"})):i.removeDataFile()},i.backgroundImageSelected=function(e){e?(i.iconConfiguration.file=e,d.base64DataUrl(e).then(function(e){i.copy.backgroundImage=e,i.copy.file=e})):i.removeBackgroundFile()},i.removeDataFile=function(){i.iconConfiguration.file=null,i.iconConfiguration.url=null},i.removeBackgroundFile=function(){i.copy.backgroundImage=null,i.copy.file=null};var n=r+"dashboard-edit.html";v.editTemplateUrl&&(n=v.editTemplateUrl);var o=a.open({scope:i,templateUrl:n,backdrop:"static",keyboard:!1,size:"lg"});i.closeDialog=function(n){n?console.warn("Dashboard config cancelled by user"):(v.title=i.copy.title,v.description=i.copy.description,"image"===i.iconConfiguration.model?v.icon=i.iconConfiguration.url:"icon"===i.iconConfiguration.model&&(v.icon=i.iconConfiguration.icon&&i.iconConfiguration.icon.key||i.iconConfiguration.icon),v.iconType=i.iconConfiguration.model,v.backgroundColor=i.copy.backgroundColor?i.copy.backgroundColor:t,v.backgroundImage=i.copy.backgroundImage?i.copy.backgroundImage:t,v.backgroundImageSize=i.backgroundSize.model,v.extraConfig=i.copy.extraConfig?i.copy.extraConfig:t,e.$broadcast("adfDashboardInternalConfigChanged",v)),o.close(),i.$destroy()}};var I=n.$on("adfOpenWidgetFromOther",function(e,t,i){var a=s(t),o=angular.merge({},a,i||{}),r={type:t,config:o,title:o.title};f(v,r,b,!n.editMode)}),A=n.$on("adfOpenModalWidgetFromOther",function(t,i,o,l){var d=r+"widget-fullscreen.html",c=o||{};c.sendSelection&&(d=r+"widget-fullscreen-selection.html");var s;if(l)s=l;else{var f=u(i);f.config=angular.merge({},f.config,c),f.type=i,f.config.title&&(f.title=f.config.title),s=n.$new(),s.definition=s.widget=f}var g={scope:s,templateUrl:d,size:s.definition.modalSize||"el",backdrop:"static",windowClass:s.definition.fullScreen?"dashboard-modal widget-fullscreen":"dashboard-modal"};n.model&&!n.model.temporal&&(s.persistDashboard=function(){e.$broadcast("adfOpenWidgetFromOther",this.$parent.widget.type,this.$parent.widget.config||{}),this.closeDialog()});var m=a.open(g);s.closeDialog=function(){m.close(),l?s.reload():s.$destroy()}}),O=n.$on("adfAddWidgetDialog",function(t){!v.temporal&&v.editable&&(n.editMode||(n.editMode=!0,n.modelCopy=angular.copy(n.adfModel,{}),e.$broadcast("adfIsEditMode")),n.addWidgetDialog())});n.addScopeCfg={widgetFilter:{},widgetSortingDirection:"",widgetSorting:"priority"},n.addWidgetDialog=function(){var e,t=c();angular.isFunction(y)?(e={},angular.forEach(o.widgets,function(t,i){y(t,i,v)&&(e[i]=t)})):e=o.widgets,t.widgets=e,angular.forEach(t.widgets,function(e,t){e.key=t,e.category||(e.category="ADF.CATEGORY.MISCELLANEOUS")}),n.options.categories?t.createCategories=p:t.availableCategories=h(e);var i=r+"widget-add.html";v.addTemplateUrl&&(i=v.addTemplateUrl);var l={scope:t,templateUrl:i,backdrop:"static",size:"lg"},d=a.open(l);t.widgetFilterCfg=n.addScopeCfg,t.addWidget=function(e){var i={type:e,Ftype:o.widgets[e].Ftype||null,config:s(e)};f(v,i,b),d.close(),t.$destroy(),g(e)&&m(n,i)},t.changeThumbnail=function(e){e.images&&(angular.isUndefined(e._currThumb)?e._currThumb=1:e._currThumb+=1,e._currThumb>=e.images.length&&(e._currThumb=0),e._currImg=e.images[e._currThumb])},t.closeDialog=function(){d.close(),t.$destroy()}},n.addNewWidgetToModel=f,n.$on("destroy",function(){E(),M(),C(),I(),A(),F(),O(),T(),$(),D()})}],link:function(e,t,i){var n={name:i.name,editable:!0,enableConfirmDelete:c(i.enableConfirmDelete),maximizable:c(i.maximizable),collapsible:c(i.collapsible),categories:c(i.categories),extraData:{}};angular.isDefined(i.editable)&&(n.editable=c(i.editable)),angular.isDefined(e.extraData)&&(n.extraData=e.extraData),n.extraData.editing=e.editMode,e.options=n},templateUrl:r+"dashboard.html"}}]),angular.module("adf").directive("adfDashboardGrid",["adfTemplatePath",function(e){function t(e){i.disableDrag=!e.editMode,i.disableResize=!e.editMode,e.gridOptions=i,e.gsHandler=null}var i={cellHeight:145,verticalMargin:10,animate:!0,"float":!1,alwaysShowResizeHandle:!0,minWidth:768,auto:!0,resizable:{handles:"e, se, s, sw, w"},disableDrag:!0,disableResize:!0};return{restrict:"E",scope:{adfModel:"=",editMode:"=",continuousEditMode:"=",options:"="},templateUrl:e+"dashboard-grid.html",compile:function(){return{pre:t}},controller:["$scope","$timeout",function(e,t){var n=[];n.push(e.$on("adfIsEditMode",function(){t(function(){e.gsHandler.enable()},100)})),n.push(e.$on("adfDashboardChanged",function(){t(function(){e.gsHandler.disable()},100)})),n.push(e.$on("adfDashboardEditsCancelled",function(i,n,a){a&&a.extraConfig&&angular.isNumber(a.extraConfig.cellHeight)&&e.gsHandler.cellHeight(a.extraConfig.cellHeight),t(function(){e.gsHandler.disable()},100)})),n.push(e.$on("adfDashboardInternalConfigChanged",function(t,i){i&&i.extraConfig&&angular.isNumber(i.extraConfig.cellHeight)&&e.gsHandler.cellHeight(i.extraConfig.cellHeight)})),n.push(e.$on("adfCancelEditMode",function(){t(function(){e.gsHandler.disable()},100)})),n.push(e.$on("adfWidgetAdded",function(i){t(function(){e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.gsHandler.enable()},100)})),e.onChange=function(t,i){e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onDragStop=function(t,i){console.log("onDragStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onResizeStop=function(t,i){console.log("onResizeStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.$broadcast("OnResizeWidget")},e.adfModel&&e.adfModel.extraConfig&&angular.isNumber(e.adfModel.extraConfig.cellHeight)&&(i.cellHeight=e.adfModel.extraConfig.cellHeight),e.$on("$destroy",function(){n.forEach(function(e){e()})})}]}}]),angular.module("adf").filter("adfOrderByObjectKey",["$filter",function(e){return function(t,i){var n=[];return angular.forEach(t,function(e,t){e[i]=t,n.push(e)}),e("orderBy")(n,i)}}]),angular.module("adf.provider",[]).provider("dashboard",function(){var e={},t="",i='<div class="alert alert-primary">{}</div>',n='      <div class="progress progress-striped active">\n        <div class="progress-bar" role="progressbar" style="width: 100%">\n          <span class="sr-only" translate>FORM.MSG.LOADING ...</span>\n        </div>\n      </div>',a=null,o=function(){return!0};this.widget=function(t,i){var n=angular.extend({reload:!1,frameless:!1},i);if(n.edit){var a={reload:!0,immediate:!1,apply:o};angular.extend(a,n.edit),n.edit=a}return n.config||(n.config={}),e[t]=n,this},this.widgetsPath=function(e){return t=e,this},this.messageTemplate=function(e){return i=e,this},this.loadingTemplate=function(e){return n=e,this},this.customWidgetTemplatePath=function(e){return a=e,this},this.$get=function(){var o=0;return{widgets:e,widgetsPath:t,messageTemplate:i,loadingTemplate:n,customWidgetTemplatePath:a,id:function(){return(new Date).getTime()+"-"+ ++o},idEquals:function(e,t){return e&&t&&e.toString()===t.toString()}}}}),angular.module("adf").directive("adfWidgetContent",["$log","$q","widgetService","$compile","$controller","$injector","dashboard","$translate",function(i,n,a,o,r,l,d,c){function s(e,t){i.warn(t),e.html(d.messageTemplate.replace(/{}/g,t))}function u(i,n,a,o){function r(t){if("custom"===t)return{from:g.config.windowFilter.from,to:g.config.windowFilter.to};if("today"===t)return{from:e.moment().startOf("day")};var i=e.moment().startOf("day").subtract(1,t);return{from:i._d}}var l=i.model;if(!l)return c("ADF.ERROR.MODEL_IS_UNDEFINED").then(function(e){s(n,e)}),a;var d=i.content;if(!d)return c("ADF.ERROR.WIDGET_FOR_DEPRECTATED",{title:l.title}).then(function(e){s(n,e)}),a;var u=i.extra,g=a;if(g){var m=!(g.menu===t||null===g.menu||g.isPaginationEnable&&g.isPaginationEnable());if(m||o||!angular.isFunction(g.reloadData))i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),g=f(i,n,a,l,d,u);else{var p=g.itemsPerPage!==t&&null!==g.itemsPerPage;(p||g.page)&&(g.page=1),g.reloadData()}}else i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),g=f(i,n,a,l,d,u);return g.config.getWindowTime=function(){var t=g.config.windowFilter;if(t&&t.type){var i=r(t.type);if(!e.eval(g.config.windowFilter.rawdate)){for(var n in i)i[n]=e.moment(i[n]).format();i.rawdate=!0}return i}},u&&(g.editing=!!u.editing,g.extraData=u),g}function f(e,i,u,f,g,m){i.html(d.loadingTemplate);var p=e.$new();f.config||(f.config={}),p.config=f.config,p.editing=m&&m.editing,m&&(p.extra=m);var h=u||p.config;p.selectionManager=h?h.selectionManager:t;var v={$scope:p,widget:f,config:f.config},y={};return y.$tpl=a.getTemplate(g),g.resolve&&angular.forEach(g.resolve,function(e,t){angular.isString(e)?y[t]=l.get(e):y[t]=l.invoke(e,e,v)}),n.all(y).then(function(e){angular.extend(e,v),g.resolveAs&&(p[g.resolveAs]=e);var t=e.$tpl;if(i.html(t),g.controller){var n=r(g.controller,e);g.controllerAs&&(p[g.controllerAs]=n),i.children().data("$ngControllerController",n)}o(i.contents())(p)},function(e){var t="ADF.ERROR.COULD_NOT_RESOLVE_ALL_PROMISSES";c(t,{reason:e?": "+e:e}).then(function(e){s(i,e)})}),u&&u.$destroy(),p}return{replace:!0,restrict:"EA",transclude:!1,require:"?^^adfWidgetGrid",scope:{model:"=",content:"=",extra:"=",navOptionsHandler:"=?",filterHandler:"=?",widgetActionsHandler:"=?"},link:function(e,t,i,n){var a=u(e,t,null);n&&(e.search=e.search||{},n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id));var o=e.$on("widgetConfigChanged",function(i,o){o?o.indexOf(e.model.wid)!==-1&&n&&n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id,!0):a=u(e,t,a,!0)}),r=e.$on("widgetReload",function(i,o){var r=!0;o&&o.length>0&&(r=o.indexOf(e.model.wid)!==-1),r&&(a=u(e,t,a,!1),n&&n.updateWidgetFilters&&n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id))});e.$on("destroy",function(){o(),r()})}}}]),angular.module("adf").factory("widgetFilter",function(){var e=function(e){e.$new(),adfTemplatePath+"widget-advanced-filter.html"};return{launchSearchingAdv:e}}),angular.module("adf").directive("adfWidgetGrid",["$injector","$q","$log","$uibModal","$rootScope","$interval","dashboard","adfTemplatePath","Filter","queryService","$timeout","$api","toastr","$translate",function(e,i,n,a,o,r,l,d,c,s,u,f,g,m){function p(e){var t=e.definition;if(t){var i=l.widgets[t.type];if(i){t.title||(t.title=i.title),t.titleTemplateUrl=d+"widget-grid-title.html",t.editTemplateUrl||(t.editTemplateUrl=d+"widget-edit.html",i.editTemplateUrl&&(t.editTemplateUrl=i.editTemplateUrl)),t.titleTemplateUrl||(t.frameless=i.frameless),t.styleClass||(t.styleClass=i.styleClass),t.wid||(t.wid=l.id()),e.widget=angular.copy(i);var a=t.config;a?angular.isString(a)&&(a=angular.fromJson(a)):a={},e.config=a,"undefined"==typeof e.widget.show_modal_footer&&(e.widget.show_modal_footer=!0),"undefined"==typeof e.widget.show_reload_config&&(e.widget.show_reload_config=!0),e.widgetState||(e.widgetState={},e.widgetState.isCollapsed=i.collapsed===!0&&i.collapsed)}else n.warn("could not find widget "+t.type)}else n.debug("definition not specified, widget was probably removed")}function h(r,l){var p=r.definition;if(!p)return void n.debug("widget not found");var h=r.config||{},y=function(){l.remove(),o.$broadcast("adfWidgetRemovedFromGrid",p)};r.remove=function(){if(r.options.enableConfirmDelete){var e=r.$new(),t=d+"widget-delete.html";p.deleteTemplateUrl&&(t=p.deleteTemplateUrl);var i={scope:e,templateUrl:t,backdrop:"static"},n=a.open(i);e.closeDialog=function(){n.close(),e.$destroy()},e.deleteDialog=function(){y(),e.closeDialog()}}else y()},r.print=function(){r.editMode||r.$broadcast("widgetPrint")},r.isExecuteOperationEnabled=function(){if(h.entityKey)return!0;var e=h.filter;if(e){if(e.headersFilter&&e.headersFilter.length>0)return!0;if("basic"===e.type)return e.value&&e.value.length>0;if("advanced"===e.type)return e.value&&e.value.length>2&&e.oql}return!1},r.executeOperation=function(){r.editMode||r.$parent.$broadcast("widgetExecuteOperation")},v("init",r),r.launchSearching=function(){if(r.widget&&!r.widget.preventRefreshFilterEvent){var e={definition:p,element:l};o.$broadcast("adfLaunchSearchingFromWidget",e,r.config.filter)}r.reload()},r.launchSearchingAdv=function(){r.filter.typeFilter=0;var e=r.$new(),i=d+"widget-advanced-filter.html",n={scope:e,templateUrl:i,backdrop:"static",size:"lg",animation:!0};e.fieldsSearch={selected:[]},e.datastreamsSearch={selected:[]},e.enableApply=!1,e.evaluating=!1,e.type=r.definition.Ftype,r.search.queryFields&&r.search.queryFields.forEach(function(t){e.fieldsSearch.selected.push(t.name),e.datastreamsSearch.selected.push({identifier:t.name})}),e.addextraElements=function(e){return"provision.device.location"===e.name?(e.existsOptions=["true","false"],e.disabledComparators=[]):e.disabledComparators=[8],e.existsOptions=["true","false"],e.dsOptions=["","._current.value","._current.source","._current.at","._current.date","._current.provType",".scoring.performance",".scoring.qrating.version",".scoring.qrating.max_score",".scoring.qrating.ideal.value",".scoring.qrating.ideal.label",".scoring.qrating.max_desired.value",".scoring.qrating.max_desired.label",".scoring.qrating.max_allowed.value",".scoring.qrating.max_allowed.label",".scoring.qrating.min_desired.value",".scoring.qrating.min_desired.label",".scoring.qrating.min_required.value",".scoring.qrating.min_required.label"],e.schemaForm={type:"object",properties:{data:e.schema}},e.form=[{key:"data",notitle:!0}],e},e.removeextraElements=function(e){return delete e.existsOptions,delete e.dsOptions,delete e.form,delete e.schemaForm,e},e.fields=r.search.queryFields?r.search.queryFields.map(function(t){return e.addextraElements(t)}):[],"entities"===r.definition.Ftype||"tickets"===r.definition.Ftype?(e.comparators=[{id:1,name:"eq",value:"=",dataTemplate:"../src/templates/input-template.html",defaultData:[]},{id:2,name:"neq",value:"!=",dataTemplate:"../src/templates/input-template.html",defaultData:[]},{id:3,name:"like",value:"~",dataTemplate:"../src/templates/input-template.html",defaultData:[]},{id:4,name:"gt",value:">",dataTemplate:"../src/templates/input-template.html",defaultData:[]},{id:5,name:"gte",value:">=",dataTemplate:"../src/templates/input-template.html",defaultData:[]},{id:6,name:"lt",value:"<",dataTemplate:"../src/templates/input-template.html",defaultData:[]},{id:7,name:"lte",value:"<=",dataTemplate:"../src/templates/input-template.html",defaultData:[]},{id:8,name:"exists",value:"?",dataTemplate:"../src/templates/filter/exist-template.html",defaultData:[]},{id:9,name:"in",value:"[]",dataTemplate:"../src/templates/filter/in-template-entities.html",defaultData:[],dataType:"array"}],f().basicTypesSearchBuilder().execute().then(function(t){200===t.statusCode?e.jsonSchemas=t.data.definitions:e.jsonSchemas={}})["catch"](function(t){e.jsonSchemas={},console.error(t)})):e.comparators=[{id:1,name:"eq",value:"="},{id:2,name:"neq",value:"!="},{id:3,name:"like",value:"~"},{id:4,name:"gt",value:">"},{id:5,name:"gte",value:">="},{id:6,name:"lt",value:"<"},{id:7,name:"lte",value:"<="},{id:8,name:"in",value:"[]",dataTemplate:"../src/templates/filter/in-template.html",defaultData:[],dataType:"array"}],e.elementSelected=function(t){e.fields.push(e.addextraElements({id:Math.floor(1e4*Math.random()+1),name:t}))},e.onSelectDatastream=function(i){var n=i.schema&&i.schema.$ref?i.schema.$ref.split("/").splice(-1)[0]:t,a=n?e.jsonSchemas[n]:i.schema?i.schema:t;delete a.javaEnumNames;var o={type:"object",properties:{data:a}};e.fields.push(e.addextraElements({id:Math.floor(1e4*Math.random()+1),name:i.identifier,type:a.type,schemaForm:o,schema:a,form:[{key:"data",notitle:!0}],schemaName:n,model:{}}))},e.onDeleteDatastream=function(t){e.fields=e.fields.filter(function(e){return e.name!==t.identifier})},e.elementDeleted=function(t){e.fields=e.fields.filter(function(e){return e.name!==t})},e.clearFieldsSearch=function(){e.advancedFilter_error=null,e.fields=[],e.fieldsSearch={selected:[]},e.datastreamsSearch={selected:[]}},e.restoreSelection=function(){selectionScope.currentSelection={selected:selectionScope.selectedItems}},e.operators=[{name:"and",value:"&&"},{name:"or",value:"||"}],e.queryBuilderfilter={group:{operator:e.operators[0],rules:[]}},e.settings={nesting:!0,addIconClass:" glyphicon glyphicon-plus",removeIconClass:"glyphicon glyphicon-trash",addButtonClass:"btn btn-sm btn-primary",removeButtonClass:"btn btn-sm btn-danger"},e.queryAsString=r.search.queryAsString?r.search.queryAsString:"",e.filterJson={},e.advancedFilter_error=null,e.evaluateQuery=function(){try{e.evaluating=!0,e.oql=s.asReadableFilter(e.queryBuilderfilter.group),e.queryAsString=s.asStringFilter(e.queryBuilderfilter.group),c.parseQuery(e.oql||"").then(function(t){u(function(){e.enableApply=!0,e.evaluating=!1}),e.filterJson=angular.toJson(t.filter,null,4),e.unknownWords="",e.advancedFilter_error=null})["catch"](function(t){e.advancedFilter_error=t,e.enableApply=!1,e.evaluating=!1,console.log(t),g.error(m.instant("TOASTR.FILTER_IS_MALFORMED"))})}catch(t){e.advancedFilter_error=t,e.enableApply=!1,g.error(m.instant("TOASTR.FILTER_IS_MALFORMED"))}},e.applyQueryBuilderFilter=function(){var i=angular.copy(e.fields);r.config.filter={type:"advanced",oql:e.oql?e.oql:"",queryAsString:e.queryAsString,value:e.filterJson||"",headersFilter:r.config.filter.headersFilter||t,queryFields:i.length>0?i.map(function(t){return e.removeextraElements(t)}):i};var n=!0;n&&(r.launchSearching(),r.filterApplied=!0)},e.$watch("queryBuilderfilter",function(t){e.enableApply=!1},!0),r.$on("clearFilter",function(t){e.enableApply=!0}),e.clearQuery=function(){delete e.oql,delete e.queryAsString,delete e.json,e.filterJson=t,e.queryBuilderfilter={group:{operator:e.operators[0],rules:[]}},e.clearFieldsSearch(),e.enableApply=!0};var o=a.open(n);e.closeDialog=function(){o.close(),e.$destroy()}},r.launchSearchingQuick=function(){r.filterApplied||(r.search||(r.search={}),r.search.oql=r.search.json="",r.config.filter={type:"basic",value:r.search.quick,headersFilter:r.config.filter.headersFilter},r.launchSearching(),r.filterApplied=!0)},r.launchSearchingShared=function(){var e=r.search.id;e?(e.filter.id=e.wid,r.config.filter=e.filter):r.config.filter={},r.launchSearching(),r.filterApplied=!0},r.filterSharedSelect=function(e,t){r.filterApplied=!1,r.launchSearchingShared()},r.filterSharedRemove=function(e,t){r.filterApplied=!1},r.enter=function(e){var t=e.keyCode?e.keyCode:e.which;13===t?(0===r.filter.typeFilter&&r.launchSearchingAdv(),1===r.filter.typeFilter&&r.launchSearchingQuick(),2===r.filter.typeFilter&&r.launchSearchingShared()):19===t?r.filter.showFinalFilter=!r.filter.showFinalFilter:r.filterApplied=!1},r.customSelectors=[],r.getCustomSelectors=function(){r.config.customSelectors?r.customSelectors=r.config.customSelectors:h.widgetSelectors().findFields("").then(function(e){r.customSelectors=e,r.$apply()})["catch"](function(e){n.error(e)})},r.changeDirection=function(){var e=h.sort.direction;"DESCENDING"===e?r.config.sort.direction="ASCENDING":"ASCENDING"===e&&(r.config.sort.direction="DESCENDING"),r.reload()},r.debugQuery=function(){c.parseQuery(r.search.oql||"").then(function(e){r.search.json=angular.toJson(e.filter,null,4),r.unknownWords="",r.filter_error=null})["catch"](function(e){r.filter_error=e})},r.autocomplete_options=function(){var e={suggest:c.suggest_field_delimited,customSelectors:h.widgetSelectors()};return e},r.selectedItems=p.selectedItems||{},r.selectionManager={currentSelection:r.selectedItems,isSelected:function(e,t){return r.selectedItems[e]&&!angular.isUndefined(t)&&(r.selectedItems[e].data=t),!!r.selectedItems[e]},totalSelected:function(){return Object.keys(r.selectedItems).length}},p.config.sendSelection&&(r.sendEntities=function(){p.config.sendSelection(r.selectedItems),r.$parent.closeDialog()},p.config.selectedItems&&(r.selectedItems=angular.copy(p.config.selectedItems)),r.config.selectionManager=r.selectionManager),r.manageSelectedItems=function(){var e=r.$new();p.config.sendSelection&&(delete h.selectionConfig.operationTypes,delete h.selectionConfig.filterTypes),e.selectionConfig=h.selectionConfig,e.selectedItems=[],angular.forEach(r.selectedItems,function(t,i){e.selectedItems.push({key:i,value:t})}),e.currentSelection={selected:e.selectedItems};var t=d+"widget-selection.html",i={scope:e,templateUrl:t,backdrop:"static",size:"lg",animation:!0},n=a.open(i);e.restoreSelection=function(){e.currentSelection={selected:e.selectedItems}},e.clearSelection=function(){e.currentSelection.selected=[]},e.applyFilter=function(t){var i=e.selectionConfig.filterAction(e.currentSelection.selected,t);angular.isUndefined(i)||null===i||(r.filter.typeFilter=0,c.parseQuery(i).then(function(e){r.search.oql=i,r.search.json=angular.toJson(e.filter,null,4),r.unknownWords="",r.filter_error=null,r.launchSearchingAdv()})["catch"](function(e){r.filter_error=e}))},e.executeOperation=function(t){r.editMode||r.$parent.$broadcast("widgetExecuteOperation",{selectedItems:e.currentSelection.selected,type:t})},e.saveChangesDialog=function(){var t={};angular.forEach(e.currentSelection.selected,function(e,i){t[e.key]={data:e.value.data,visible:e.value.visible}}),r.selectedItems=angular.copy(t),r.selectedItemsLength=Object.keys(r.selectedItems).length,r.selectionManager.lastItem={},r.$broadcast("widgetSelectionChanged",r.selectionManager),n.close(),e.$destroy()},e.closeDialog=function(){n.close(),e.$destroy()}},r.edit=function(t){function n(e){var t;if("boolean"==typeof e){var n=i.defer();e?n.resolve():n.reject(),t=n.promise}else t=i.when(e);return t}var l=r.$new();l.definition=angular.copy(p);var c=d+"widget-edit.html";p.editTemplateUrl&&(c=p.editTemplateUrl);var s={scope:l,templateUrl:c,backdrop:"static",size:"lg"},u=a.open(s);l.closeDialog=function(e){u.close(),t&&"close"===e&&o.$broadcast("adfWidgetRemovedFromGrid",l.definition),l.$destroy()},l.saveDialog=function(){l.validationError=null;var t,i=r.widget;t=i.edit?i.edit.apply:function(){return!0};var a=l.definition.config||{},o={widget:i,definition:l.definition,config:a},d=e.invoke(t,t,o);n(d).then(function(){p.title=l.definition.title,"summaryChart"===l.definition.type&&("ENTITIES_VALUES"===l.definition.config.type?(l.definition.Ftype="entities",p.Ftype="entities"):(l.definition.Ftype=l.definition.config.type.toLowerCase(),p.Ftype=l.definition.config.type.toLowerCase())),angular.extend(p.config,a),l.closeDialog(),i.edit&&i.edit.reload&&(r.setReloadTimeout(),r.$broadcast("widgetConfigChanged"))},function(e){e?l.validationError=e:l.validationError="VALIDATION_DURING_APPLY_FAILED"})}}}var v=function(e,i){var n=i.config||{},a=n.filter=n.filter?n.filter:{},o=a.id=e&&a.id;switch(a.headersFilter=e&&a.headersFilter,i.filter||(i.filter={}),a.type){case"advanced":i.filter.typeFilter=o?2:0,i.search={oql:a.oql,json:a.value,queryAsString:a.queryAsString||"",queryFields:a.queryFields||t};break;case"basic":i.filter.typeFilter=o?2:1,i.search={quick:a.value};break;default:i.filter.typeFilter=o?2:1,i.search={quick:a.value=""}}i.search.id=e};return{replace:!0,restrict:"EA",transclude:!1,templateUrl:d+"widget-grid.html",scope:{definition:"=",editMode:"=",options:"=",widgetState:"="},controller:["$scope","$element",function(e,i){e.filter={typeFilter:1,showFilter:!1,showFinalFilter:!1};var d=e.$on("onWindowTimeChanged",function(t,n){e.config.windowFilter=n?n:config.windowFilter?{}:n;var a={definition:c,element:i};o.$broadcast("adfWindowTimeChangedFromWidget",a,e.config.windowFilter),e.$broadcast("widgetWindowTimeChanged",e.config.windowFilter),e.reload()});this.updateWidgetFilters=function(t,i){if(e.options&&e.options.extraData&&e.options.extraData.widgetFilters){var n,a=e.options.extraData.widgetFilters,o=e.definition,r=a.filter(function(e){var i=!(e.filter&&e.filter.id||e.Ftype!==o.Ftype||e.wid===o.wid);return i&&t===e.wid&&(n=e),i});e.sharedFilters=angular.copy(r),(!i||!n&&t)&&v(n,e)}};var c=e.definition;c.config.selectedItems&&(e.selectedItemsLength=Object.keys(c.config.selectedItems).length),e.navOptionsHandler={firstLoad:!0,loadingData:!1,startLoading:function(){e.navOptionsHandler.loadingData=!0},stopLoading:function(){e.navOptionsHandler.firstLoad=!1,e.navOptionsHandler.loadingData=!1,e.navOptionsHandler.lastMessageTime=new Date},setStatusMessage:function(t){e.navOptionsHandler.statusMessage=t,e.navOptionsHandler.lastMessageTime=new Date}},e.filterHandler={changeFilter:function(t,i,n){e.search=i,e.filter.typeFilter=n}},e.widgetActionsHandler={actions:[],setActions:function(t){e.widgetActionsHandler.actions=t}};var s=e.$on("adfDashboardCollapseExpand",function(t,i){e.widgetState.isCollapsed=i.collapseExpandStatus}),u=e.$on("adfWidgetEnterEditMode",function(t,i){l.idEquals(c.wid,i.wid)&&e.edit(!0)}),f=e.$on("adfIsEditMode",function(t,i){e.editing=!0}),g=e.$on("adfDashboardChanged",function(t,i,n){var a=[],o=n.grid;if(o&&o.length>0){o.forEach(function(e){var t=e.definition;a.push(t.wid)});var r=e.options&&e.options.extraData&&e.options.extraData.widgetFilters,l=r.filter(function(e){var t=e.filter;return t&&!t.id||a.indexOf(t.id)!==-1});e.sharedFilters=angular.copy(l),e.editing=!1,e.$broadcast("widgetConfigChanged",a)}}),m=e.$on("adfDashboardEditsCancelled",function(t,i){e.editing=!1});e.openFullScreen=function(){var t=document.getElementsByClassName("widget widget_"+e.definition.wid);t[0].requestFullscreen?(t[0].requestFullscreen(),e.$broadcast("OnResizeWidget")):t[0].mozRequestFullScreen?(t[0].mozRequestFullScreen(),e.$broadcast("OnResizeWidget")):t[0].webkitRequestFullscreen?(t[0].webkitRequestFullscreen(),e.$broadcast("OnResizeWidget")):t[0].msRequestFullscreen?(t[0].msRequestFullscreen(),e.$broadcast("OnResizeWidget")):e.$emit("adfOpenModalWidgetFromOther",c.type,e.config||{},e)},e.openAboutScreen=function(t){t="md";var i=a.open({animation:!0,templateUrl:"widgetAboutModal.html",controller:["$scope","$uibModalInstance","information",function(e,t,i){e.about={},e.about.info=i,e.ok=function(){t.close()}}],size:t,resolve:{information:function(){return e.config.about}}});i.result.then(function(t){e.selected=t},function(){n.info("Modal dismissed at: "+new Date)})},e.saveWidgetScreen=function(t){e.$emit("generateSnapshot",{objectSelector:".widget_"+t,fileName:"capture_"+(new Date).getTime()})},e.moveWidgetToDashboard=function(t){e.$emit("ouxWidget-move",{objectSelector:".widget_"+t},t)},e.copyWidgetToDashboard=function(t){
e.$emit("ouxWidget-copy",{objectSelector:".widget_"+t},t)};var p=function(t){var i,n={or:[]};return t.forEach(function(t){i={},i[t.operator]={},i[t.operator][t.name]=e.config.filter.value,n.or.push(i)}),n};e.downloadCsv=function(){var i,n=e.config.columns,a=e.config.filter,o={},r=e.config.sort?e.config.sort:t;if(e.config.getWindowTime&&e.config.onWindowTimeChanged){var l=e.config.getWindowTime(),d=e.config.onWindowTimeChanged(l);d&&d.and&&(i={and:d.and})}var c;a.type&&"advanced"===a.type&&a.value.length>4?c=JSON.parse(a.value):a.type&&"basic"===a.type&&""!==a.value.trim()&&(c=p(e.config.fieldsQuickSearch,a.value)),o=i?c?{and:[i,c]}:i:c,e.$broadcast("downloadCsv",{columns:n,filter:o,order:r})},e.generateQR=function(){e.$broadcast("generateQR")};var h,y=e.$on("addItemToSelection",function(t,i){e.selectedItems[i.key]||(e.selectedItems[i.key]={data:i.data,visible:i.visible},e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!0,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))}),b=e.$on("removeItemFromSelection",function(t,i){e.selectedItems[i.key]&&(delete e.selectedItems[i.key],e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!1,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))});e.setReloadTimeout=function(){var i=e.config||e.definition.config||{},n=i.reloadPeriod;isNaN(n)||1*n===0?h&&r.cancel(h):(angular.isDefined(h)&&(r.cancel(h),h=t),h=r(e.reload,1e3*n))},e.reload=function(){e.$broadcast("widgetReload"),e.setReloadTimeout()},e.setReloadTimeout(),e.$on("$destroy",function(){s(),u(),f(),g(),m(),y(),b(),d(),r.cancel(h)})}],compile:function(){return{pre:p,post:h}}}}]),angular.module("adf").factory("widgetService",["$http","$q","$sce","$templateCache","dashboard",function(e,t,i,n,a){function o(e){var t=e;return e.indexOf("{widgetsPath}")>=0&&(t=e.replace("{widgetsPath}",a.widgetsPath).replace("//","/"),0===t.indexOf("/")&&(t=t.substring(1))),t}var r={};return r.getTemplate=function(a){var r=t.defer();if(a.template)r.resolve(a.template);else if(a.templateUrl){var l=n.get(a.templateUrl);if(l)r.resolve(l);else{var d=i.getTrustedResourceUrl(o(a.templateUrl));e.get(d).success(function(e){n.put(a.templateUrl,e),r.resolve(e)}).error(function(){r.reject("could not load template")})}}return r.promise},r}])}(window);
//# sourceMappingURL=opengate-angular-dashboard-framework.min.js.map
