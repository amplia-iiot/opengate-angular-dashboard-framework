!function(e,t){"use strict";angular.module("adf",["adf.provider","ui.bootstrap","opengate-angular-js"]).value("adfTemplatePath","../src/templates/").value("columnTemplate",'<adf-dashboard-column column="column" adf-model="adfModel" options="options" edit-mode="editMode" ng-repeat="column in row.columns" />').value("adfVersion","7.0.0"),angular.module("adf").directive("adfDashboard",["$rootScope","$log","$timeout","$uibModal","dashboard","adfTemplatePath","$faIcons","$translate","Upload",function(e,i,n,o,a,r,l,d,c){function s(e){switch(angular.isDefined(e)?e.toLowerCase():null){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function f(e){var t={},i=a.widgets[e].config;return i&&(t=angular.copy(i)),t}function g(e){var t={},i=a.widgets[e];return i&&(t=angular.copy(i)),t}function u(t,n,o,a){if(t){t.grid||(t.grid=[]);var r={width:3,height:2,x:0,y:0,definition:n};t.grid.push(r),e.$broadcast("adfWidgetAdded",o,t,n),a&&e.$broadcast("adfDashboardChanged",o,t)}else i.error("model is undefined")}function p(e){var t=a.widgets[e];return t&&t.edit&&t.edit.immediate}function m(e,t){n(function(){e.$broadcast("adfWidgetEnterEditMode",t)},200)}function h(e){var t={};return angular.forEach(e,function(e,i){var n=e.category;n||(n="ADF.CATEGORY.MISCELANOUS"),e.title=d.instant(e.title),e.description=d.instant(e.description),e.category=d.instant(e.category),angular.isUndefined(t[e.category])&&(t[e.category]={widgets:{}}),t[e.category].widgets[i]=e}),t}function v(e){var t=[];return angular.forEach(e,function(e,i){e.category||(e.category="ADF.CATEGORY.MISCELLANEOUS"),e.title=d.instant(e.title),e.description=d.instant(e.description),e.category=d.instant(e.category),e.categoryTags||(e.categoryTags="ADF.CATEGORY.TAG.MISCELLANEOUS");var n=e.categoryTags.split(",");angular.forEach(n,function(e,i){var n=d.instant(e);t.indexOf(n)===-1&&t.push(n)})}),t}return{replace:!0,restrict:"EA",transclude:!1,scope:{name:"@",collapsible:"@",editable:"@",editMode:"@",continuousEditMode:"=",maximizable:"@",adfModel:"=",adfWidgetFilter:"=",categories:"@",hideButtons:"=",extraData:"="},controller:["$scope",function(n){function s(){var e=n.$new();return e}var w={},b=null,y=n.name,S=function(e){var t={configChange:[],reload:[]};if(e){var i=angular.copy(e.definition),n=i.Ftype,o=i.wid,a=i.config;if(a){var r=a.filter;w.grid.forEach(function(e){var i=e.definition.config.filter,a=e.definition.Ftype;i&&i.id&&i.id===o?(e.definition.config.filter=r,e.definition.config.filter.id=o,t.reload.push(e.definition.wid)):n===a&&t.configChange.push(e.definition.wid)})}}return t},$=function(e){var t=[],i=e.grid;i&&i.length>0&&i.forEach(function(e){var i=e.definition,n=i.config,o=n.filter;t.push({wid:i.wid,title:i.title,filter:o,Ftype:i.Ftype})}),n.options||(n.options={extraData:{}}),n.options.extraData.widgetFilters=t};n.$watch("adfModel",function(e,t){(null!==t||null===e&&null===t)&&(w=n.adfModel,b=n.adfWidgetFilter,w?($(w),w.title||(w.title=d.instant("ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD")),w.titleTemplateUrl||(w.titleTemplateUrl=r+"dashboard-title.html"),n.model=w):i.error("could not find or create model"))},!0),n.editMode=!1,n.toggleEditMode=function(t){n.editMode=!n.editMode,n.editMode&&(n.continuousEditMode||(n.modelCopy=angular.copy(n.adfModel,{}),e.$broadcast("adfIsEditMode")),t&&n.editDashboardDialog()),n.editMode||e.$broadcast("adfDashboardChanged",y,w)};var D=n.$on("adfToggleEditMode",function(e,t){t?n.toggleEditMode(!0):n.toggleEditMode()}),C=n.$on("adfCancelEditMode",function(e){n.editMode&&n.cancelEditMode()}),F=n.$on("adfWidgetRemovedFromGrid",function(e,t){var i=null;angular.forEach(n.adfModel.grid,function(e,n){e.definition.wid===t.wid&&(i=n)}),i>=0&&n.adfModel.grid.splice(i,1)});n.cancelEditMode=function(){n.editMode=!1,n.continuousEditMode||n.modelCopy===n.adfModel||(n.modelCopy=angular.copy(n.modelCopy,n.adfModel)),e.$broadcast("adfDashboardEditsCancelled")};var E=n.$on("adfEditDashboardDialog",function(e){n.editMode&&n.editDashboardDialog()}),I=n.$on("adfLaunchSearchingFromWidget",function(t,i){var n=S(i);e.$broadcast("adfFilterChanged",y,w,n)}),M=n.$on("adfWindowTimeChangedFromWidget",function(t){e.$broadcast("adfFilterChanged",y,w)});n.editDashboardDialog=function(){var e=s();e.copy={title:"ADF.DASHBOARD.TITLE.EMPTY_DASHBOARD"!==w.title?w.title:"",description:w.description,backgroundColor:w.backgroundColor?w.backgroundColor:t,time:new Date,backgroundImage:w.backgroundImage?w.backgroundImage:t,file:w.backgroundImage?w.backgroundImage:t},e.backgroundSize={name:"backgroundSize",model:w.backgroundImageSize?w.backgroundImageSize:"100% 100%",options:{"100% 100%":{title:d.instant("SIZE_CONF.AUTO")},contain:{title:d.instant("SIZE_CONF.CONTAIN")},cover:{title:d.instant("SIZE_CONF.COVER")}}},e.iconConfiguration={name:"iconConfiguration",model:w.iconType?w.iconType:"icon",url:t,file:t,iconType:w.iconType?w.iconType:"icon",icon:"icon"===w.iconType?w.icon:"fa-tachometer",options:{icon:{title:d.instant("ICON.LIBRARY")},image:{title:d.instant("ICON.IMAGE")}}},"image"===e.iconConfiguration.iconType&&(e.iconConfiguration.file=w.icon,e.iconConfiguration.url=w.icon),e.imageSelected=function(t){t?(e.iconConfiguration.file=t,c.base64DataUrl(t).then(function(t){e.iconConfiguration.url=t,e.iconConfiguration.file=t,e.iconConfiguration.iconType="image"})):e.removeDataFile()},e.backgroundImageSelected=function(t){t?(e.iconConfiguration.file=t,c.base64DataUrl(t).then(function(t){e.copy.backgroundImage=t,e.copy.file=t})):e.removeBackgroundFile()},e.removeDataFile=function(){e.iconConfiguration.file=null,e.iconConfiguration.url=null},e.removeBackgroundFile=function(){e.copy.backgroundImage=null,e.copy.file=null},e.availableIcons=l.list();var i=r+"dashboard-edit.html";w.editTemplateUrl&&(i=w.editTemplateUrl);var n=o.open({scope:e,templateUrl:i,backdrop:"static",keyboard:!1,size:"lg"});e.closeDialog=function(){w.title=e.copy.title,w.description=e.copy.description,"image"===e.iconConfiguration.model?w.icon=e.iconConfiguration.url:"icon"===e.iconConfiguration.model&&(w.icon=e.iconConfiguration.icon),w.iconType=e.iconConfiguration.model,w.backgroundColor=e.copy.backgroundColor?e.copy.backgroundColor:t,w.backgroundImage=e.copy.backgroundImage?e.copy.backgroundImage:t,w.backgroundImageSize=e.backgroundSize.model,n.close(),e.$destroy()}};var T=n.$on("adfOpenWidgetFromOther",function(e,t,i){var o=f(t),a=angular.merge({},o,i),r={type:t,config:a,title:a.title};u(w,r,y,!n.editMode)}),O=n.$on("adfOpenModalWidgetFromOther",function(t,i,a){var l=r+"widget-fullscreen.html";a.sendSelection&&(l=r+"widget-fullscreen-selection.html");var d=g(i);d.config=angular.merge({},d.config,a),d.type=i,d.config.title&&(d.title=d.config.title);var c=n.$new();c.definition=c.widget=d;var s={scope:c,templateUrl:l,size:c.definition.modalSize||"el",backdrop:"static",windowClass:c.definition.fullScreen?"dashboard-modal widget-fullscreen":"dashboard-modal"};n.model&&!n.model.temporal&&(c.persistDashboard=function(){e.$broadcast("adfOpenWidgetFromOther",this.$parent.widget.type,this.$parent.widget.config),this.closeDialog()});var f=o.open(s);c.closeDialog=function(){f.close(),c.$destroy()}}),k=n.$on("adfAddWidgetDialog",function(t){!w.temporal&&w.editable&&(n.editMode||(n.editMode=!0,n.modelCopy=angular.copy(n.adfModel,{}),e.$broadcast("adfIsEditMode")),n.addWidgetDialog())});n.addScopeCfg={widgetFilter:{},widgetSortingDirection:"",widgetSorting:"priority"},n.addWidgetDialog=function(){var e,t=s();angular.isFunction(b)?(e={},angular.forEach(a.widgets,function(t,i){b(t,i,w)&&(e[i]=t)})):e=a.widgets,t.widgets=e,angular.forEach(t.widgets,function(e,t){e.key=t,e.category||(e.category="Miscellaneous")}),n.options.categories?t.createCategories=h:t.availableCategories=v(e);var i=r+"widget-add.html";w.addTemplateUrl&&(i=w.addTemplateUrl);var l={scope:t,templateUrl:i,backdrop:"static",size:"lg"},d=o.open(l);t.widgetFilterCfg=n.addScopeCfg,t.addWidget=function(e){var i={type:e,Ftype:a.widgets[e].Ftype||null,config:f(e)};u(w,i,y),d.close(),t.$destroy(),p(e)&&m(n,i)},t.changeThumbnail=function(e){e.images&&(angular.isUndefined(e._currThumb)?e._currThumb=1:e._currThumb+=1,e._currThumb>=e.images.length&&(e._currThumb=0),e._currImg=e.images[e._currThumb])},t.closeDialog=function(){d.close(),t.$destroy()}},n.addNewWidgetToModel=u,n.$on("destroy",function(){I(),M(),D(),T(),O(),C(),k(),E(),F()})}],link:function(e,t,i){var n={name:i.name,editable:!0,enableConfirmDelete:s(i.enableConfirmDelete),maximizable:s(i.maximizable),collapsible:s(i.collapsible),categories:s(i.categories),extraData:{}};angular.isDefined(i.editable)&&(n.editable=s(i.editable)),angular.isDefined(e.extraData)&&(n.extraData=e.extraData),n.extraData.editing=e.editMode,e.options=n},templateUrl:r+"dashboard.html"}}]),angular.module("adf").directive("adfDashboardGrid",["adfTemplatePath",function(e){function t(e){e.gridOptions={cellHeight:146,verticalMargin:10,animate:!0,"float":!1,alwaysShowResizeHandle:!0,minWidth:768,auto:!0,resizable:{handles:"e, se, s, sw, w"},disableDrag:!e.editMode,disableResize:!e.editMode},e.gsHandler=null}return{restrict:"E",scope:{adfModel:"=",editMode:"=",continuousEditMode:"=",options:"="},templateUrl:e+"dashboard-grid.html",compile:function(){return{pre:t}},controller:["$scope","$timeout",function(e,t){var i=[];i.push(e.$on("adfIsEditMode",function(){t(function(){e.gsHandler.enable()},100)})),i.push(e.$on("adfDashboardChanged",function(){t(function(){e.gsHandler.disable()},100)})),i.push(e.$on("adfDashboardEditsCancelled",function(){t(function(){e.gsHandler.disable()},100)})),i.push(e.$on("adfCancelEditMode",function(){t(function(){e.gsHandler.disable()},100)})),i.push(e.$on("adfWidgetAdded",function(i){t(function(){e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.gsHandler.enable()},100)})),e.onChange=function(t,i){e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onDragStart=function(e,t){console.log("onDragStart event: "+e+" ui:"+t)},e.onDragStop=function(t,i){console.log("onDragStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid)},e.onResizeStart=function(e,t){console.log("onResizeStart event: "+e+" ui:"+t)},e.onResizeStop=function(t,i){console.log("onResizeStop event: "+t+" ui:"+i),e.adfModel.grid=GridStackUI.Utils.sort(e.adfModel.grid),e.$broadcast("OnResizeWidget")},e.onItemAdded=function(e){console.log("onItemAdded item: "+e)},e.onItemRemoved=function(e){console.log("onItemRemoved item: "+e)},e.$on("destroy",function(){i.forEach(function(e){e()})})}]}}]),angular.module("adf").filter("adfOrderByObjectKey",["$filter",function(e){return function(t,i){var n=[];return angular.forEach(t,function(e,t){e[i]=t,n.push(e)}),e("orderBy")(n,i)}}]),angular.module("adf.provider",[]).provider("dashboard",function(){var e={},t="",i='<div class="alert alert-primary">{}</div>',n='      <div class="progress progress-striped active">\n        <div class="progress-bar" role="progressbar" style="width: 100%">\n          <span class="sr-only" translate>FORM.MSG.LOADING ...</span>\n        </div>\n      </div>',o=null,a=function(){return!0};this.widget=function(t,i){var n=angular.extend({reload:!1,frameless:!1},i);if(n.edit){var o={reload:!0,immediate:!1,apply:a};angular.extend(o,n.edit),n.edit=o}return e[t]=n,this},this.widgetsPath=function(e){return t=e,this},this.messageTemplate=function(e){return i=e,this},this.loadingTemplate=function(e){return n=e,this},this.customWidgetTemplatePath=function(e){return o=e,this},this.$get=function(){var a=0;return{widgets:e,widgetsPath:t,messageTemplate:i,loadingTemplate:n,customWidgetTemplatePath:o,id:function(){return(new Date).getTime()+"-"+ ++a},idEquals:function(e,t){return e&&t&&e.toString()===t.toString()}}}}),angular.module("adf").directive("adfWidgetContent",["$log","$q","widgetService","$compile","$controller","$injector","dashboard","$translate",function(i,n,o,a,r,l,d,c){function s(e,t){i.warn(t),e.html(d.messageTemplate.replace(/{}/g,t))}function f(i,n,o,a){function r(t){if("custom"===t)return{from:u.config.windowFilter.from,to:u.config.windowFilter.to};var i=e.moment().subtract(1,t);return{from:i._d}}var l=i.model;if(!l)return c("ADF.ERROR.MODEL_IS_UNDEFINED").then(function(e){s(n,e)}),o;var d=i.content;if(!d)return c("ADF.ERROR.WIDGET_FOR_DEPRECTATED",{title:l.title}).then(function(e){s(n,e)}),o;var f=i.extra,u=o;if(u){var p=!(u.menu===t||null===u.menu||u.isPaginationEnable&&u.isPaginationEnable());if(p||a||!angular.isFunction(u.reloadData))i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),u=g(i,n,o,l,d,f);else{var m=u.itemsPerPage!==t&&null!==u.itemsPerPage;(m||u.page)&&(u.page=1),u.reloadData()}}else i.navOptionsHandler&&(i.navOptionsHandler.firstLoad=!0),u=g(i,n,o,l,d,f);return u.config&&(u.config.getWindowTime=function(){var t=u.config.windowFilter;if(t&&t.type){var i=r(t.type);if(!e.eval(u.config.windowFilter.rawdate)){for(var n in i)i[n]=e.moment(i[n]).format();i.rawdate=!0}return i}}),f&&(u.editing=!!f.editing,u.extraData=f),u}function g(e,i,f,g,u,p){i.html(d.loadingTemplate);var m=e.$new();g.config||(g.config={}),m.config=g.config,m.editing=p&&p.editing,p&&(m.extra=p);var h=f||m.config;m.selectionManager=h?h.selectionManager:t;var v={$scope:m,widget:g,config:g.config},w={};return w.$tpl=o.getTemplate(u),u.resolve&&angular.forEach(u.resolve,function(e,t){angular.isString(e)?w[t]=l.get(e):w[t]=l.invoke(e,e,v)}),n.all(w).then(function(e){angular.extend(e,v),u.resolveAs&&(m[u.resolveAs]=e);var t=e.$tpl;if(i.html(t),u.controller){var n=r(u.controller,e);u.controllerAs&&(m[u.controllerAs]=n),i.children().data("$ngControllerController",n)}a(i.contents())(m)},function(e){var t="ADF.ERROR.COULD_NOT_RESOLVE_ALL_PROMISSES";c(t,{reason:e?": "+e:e}).then(function(e){s(i,e)})}),f&&f.$destroy(),m}return{replace:!0,restrict:"EA",transclude:!1,require:"?^^adfWidgetGrid",scope:{model:"=",content:"=",extra:"=",navOptionsHandler:"=?",filterHandler:"=?",widgetActionsHandler:"=?"},link:function(e,t,i,n){var o=f(e,t,null);n&&(e.search=e.search||{},n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id));var a=e.$on("widgetConfigChanged",function(i,a){a?a.indexOf(e.model.wid)!==-1&&n&&n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id,!0):o=f(e,t,o,!0)}),r=e.$on("widgetReload",function(i,a){var r=!0;a&&a.length>0&&(r=a.indexOf(e.model.wid)!==-1),r&&(o=f(e,t,o,!1),n&&n.updateWidgetFilters&&n.updateWidgetFilters(e.model.config.filter&&e.model.config.filter.id))});e.$on("destroy",function(){a(),r()})}}}]),angular.module("adf").directive("adfWidgetGrid",["$injector","$q","$log","$uibModal","$rootScope","$interval","dashboard","adfTemplatePath","Filter",function(e,i,n,o,a,r,l,d,c){function s(e){var t=e.definition;if(t){var i=l.widgets[t.type];if(i){t.title||(t.title=i.title),t.titleTemplateUrl=d+"widget-grid-title.html",t.editTemplateUrl||(t.editTemplateUrl=d+"widget-edit.html",i.editTemplateUrl&&(t.editTemplateUrl=i.editTemplateUrl)),t.titleTemplateUrl||(t.frameless=i.frameless),t.styleClass||(t.styleClass=i.styleClass),t.wid||(t.wid=l.id()),e.widget=angular.copy(i);var o=t.config;o?angular.isString(o)&&(o=angular.fromJson(o)):o={},"undefined"==typeof e.widget.show_modal_footer&&(e.widget.show_modal_footer=!0),"undefined"==typeof e.widget.show_reload_config&&(e.widget.show_reload_config=!0),e.config=o,e.widgetState||(e.widgetState={},e.widgetState.isCollapsed=i.collapsed===!0&&i.collapsed)}else n.warn("could not find widget "+t.type)}else n.debug("definition not specified, widget was probably removed")}function f(t,r){var l=t.definition;if(!l)return void n.debug("widget not found");t.config||(t.config={});var s=t.config,f=function(){r.remove(),a.$broadcast("adfWidgetRemovedFromGrid",l)};t.remove=function(){if(t.options.enableConfirmDelete){var e=t.$new(),i=d+"widget-delete.html";l.deleteTemplateUrl&&(i=l.deleteTemplateUrl);var n={scope:e,templateUrl:i,backdrop:"static"},a=o.open(n);e.closeDialog=function(){a.close(),e.$destroy()},e.deleteDialog=function(){f(),e.closeDialog()}}else f()},t.print=function(){t.editMode||t.$broadcast("widgetPrint")},t.isExecuteOperationEnabled=function(){if(s.entityKey)return!0;var e=s.filter;return e&&"basic"===e.type?e.value.length>0:!(!e||"advanced"!==e.type)&&(e.value.length>2&&e.oql)},t.executeOperation=function(){t.editMode||t.$parent.$broadcast("widgetExecuteOperation")},t.filter={typeFilter:1,showFilter:!1,showFinalFilter:!1},t.launchSearching=function(){var e={definition:l,element:r};a.$broadcast("adfLaunchSearchingFromWidget",e,t.config.filter),t.reload()},t.launchSearchingAdv=function(){t.filterApplied||(t.search.quick="",""===t.search.json||"{}"===t.search.json||!angular.isString(t.search.json)&&0===Object.keys(t.search.json).length?t.config.filter={type:"advanced",oql:"",value:""}:t.config.filter={type:"advanced",oql:t.search.oql,value:t.search.json,headersFilter:t.config.filter.headersFilter},t.launchSearching(),t.filterApplied=!0)},t.launchSearchingQuick=function(){t.filterApplied||(t.search.oql=t.search.json="",t.config.filter={type:"basic",value:t.search.quick,headersFilter:t.config.filter.headersFilter},t.launchSearching(),t.filterApplied=!0)},t.launchSearchingShared=function(){var e=t.search.id;e?(e.filter.id=e.wid,t.config.filter=e.filter):t.config.filter={},t.launchSearching(),t.filterApplied=!0},t.filterSharedSelect=function(e,i){t.filterApplied=!1,t.launchSearchingShared()},t.filterSharedRemove=function(e,i){t.filterApplied=!1};t.$on("onWindowTimeChanged",function(e,i){t.config.windowFilter=i?i:s.windowFilter?{}:i;var n={definition:l,element:r};a.$broadcast("adfWindowTimeChangedFromWidget",n,t.config.windowFilter),t.reload()});t.enter=function(e){var i=e.keyCode?e.keyCode:e.which;13===i?(0===t.filter.typeFilter&&t.launchSearchingAdv(),1===t.filter.typeFilter&&t.launchSearchingQuick(),2===t.filter.typeFilter&&t.launchSearchingShared()):19===i?t.filter.showFinalFilter=!t.filter.showFinalFilter:t.filterApplied=!1},t.customSelectors=[],t.getCustomSelectors=function(){t.config.customSelectors?t.customSelectors=t.config.customSelectors:s.widgetSelectors().findFields("").then(function(e){t.customSelectors=e,t.$apply()})["catch"](function(e){n.error(e)})},t.changeDirection=function(){var e=s.sort.direction;"DESCENDING"===e?t.config.sort.direction="ASCENDING":"ASCENDING"===e&&(t.config.sort.direction="DESCENDING"),t.reload()},t.debugQuery=function(){c.parseQuery(t.search.oql||"").then(function(e){t.search.json=angular.toJson(e.filter,null,4),t.unknownWords="",t.filter_error=null})["catch"](function(e){t.filter_error=e})},t.autocomplete_options=function(){var e={suggest:c.suggest_field_delimited,customSelectors:s.widgetSelectors()};return e},t.selectedItems=l.selectedItems||{},t.selectionManager={currentSelection:t.selectedItems,isSelected:function(e,i){return t.selectedItems[e]&&!angular.isUndefined(i)&&(t.selectedItems[e].data=i),!!t.selectedItems[e]},totalSelected:function(){return Object.keys(t.selectedItems).length}},l.config.sendSelection&&(t.sendEntities=function(){l.config.sendSelection(t.selectedItems),t.$parent.closeDialog()},l.config.selectedItems&&(t.selectedItems=angular.copy(l.config.selectedItems)),t.config.selectionManager=t.selectionManager),t.manageSelectedItems=function(){var e=t.$new();l.config.sendSelection&&(delete s.selectionConfig.operationTypes,delete s.selectionConfig.filterTypes),e.selectionConfig=s.selectionConfig,e.selectedItems=[],angular.forEach(t.selectedItems,function(t,i){e.selectedItems.push({key:i,value:t})}),e.currentSelection={selected:e.selectedItems};var i=d+"widget-selection.html",n={scope:e,templateUrl:i,backdrop:"static",size:"lg",animation:!0},a=o.open(n);e.restoreSelection=function(){e.currentSelection={selected:e.selectedItems}},e.clearSelection=function(){e.currentSelection.selected=[]},e.applyFilter=function(i){var n=e.selectionConfig.filterAction(e.currentSelection.selected,i);angular.isUndefined(n)||null===n||(t.filter.typeFilter=0,c.parseQuery(n).then(function(e){t.search.oql=n,t.search.json=angular.toJson(e.filter,null,4),t.unknownWords="",t.filter_error=null,t.launchSearchingAdv()})["catch"](function(e){t.filter_error=e}))},e.executeOperation=function(i){t.editMode||t.$parent.$broadcast("widgetExecuteOperation",{selectedItems:e.currentSelection.selected,type:i})},e.saveChangesDialog=function(){var i={};angular.forEach(e.currentSelection.selected,function(e,t){i[e.key]={data:e.value.data,visible:e.value.visible}}),t.selectedItems=angular.copy(i),t.selectedItemsLength=Object.keys(t.selectedItems).length,t.selectionManager.lastItem={},t.$broadcast("widgetSelectionChanged",t.selectionManager),a.close(),e.$destroy()},e.closeDialog=function(){a.close(),e.$destroy()}},t.edit=function(){function n(e){var t;if("boolean"==typeof e){var n=i.defer();e?n.resolve():n.reject(),t=n.promise}else t=i.when(e);return t}var a=t.$new();a.definition=angular.copy(l);var r=d+"widget-edit.html";l.editTemplateUrl&&(r=l.editTemplateUrl);var c={scope:a,templateUrl:r,backdrop:"static",size:"lg"},s=o.open(c);a.closeDialog=function(){s.close(),a.$destroy()},a.saveDialog=function(){a.validationError=null;var i,o=t.widget;i=o.edit?o.edit.apply:function(){return!0};var r={widget:o,definition:a.definition,config:a.definition.config},d=e.invoke(i,i,r);n(d).then(function(){l.title=a.definition.title,"summaryChart"===a.definition.type&&(a.definition.Ftype=a.definition.config.type.toLowerCase(),l.Ftype=a.definition.config.type.toLowerCase()),angular.extend(l.config,a.definition.config),a.closeDialog(),o.edit&&o.edit.reload&&(t.setReloadTimeout(),t.$broadcast("widgetConfigChanged"))},function(e){e?a.validationError=e:a.validationError="VALIDATION_DURING_APPLY_FAILED"})}}}return{replace:!0,restrict:"EA",transclude:!1,templateUrl:d+"widget-grid.html",scope:{definition:"=",editMode:"=",options:"=",widgetState:"="},controller:["$scope",function(e){var i=function(t){var i=e.config,n=i.filter=i.filter?i.filter:{},o=n.id=t&&n.id;switch(n.headersFilter=t&&i.filter.headersFilter,n.type){case"advanced":e.filter.typeFilter=o?2:0,e.search={oql:n.oql,json:n.value};break;case"basic":e.filter.typeFilter=o?2:1,e.search={quick:n.value};break;default:e.filter.typeFilter=o?2:1,e.search={quick:n.value=""}}e.search.id=t};this.updateWidgetFilters=function(t,n){if(e.options&&e.options.extraData&&e.options.extraData.widgetFilters){var o,a=e.options.extraData.widgetFilters,r=e.definition,l=a.filter(function(e){var i=!(e.filter&&e.filter.id||e.Ftype!==r.Ftype||e.wid===r.wid);return i&&t===e.wid&&(o=e),i});e.sharedFilters=angular.copy(l),(!n||!o&&t)&&i(o)}};var a=e.definition;a.config.selectedItems&&(e.selectedItemsLength=Object.keys(a.config.selectedItems).length),e.navOptionsHandler={firstLoad:!0,loadingData:!1,startLoading:function(){e.navOptionsHandler.loadingData=!0},stopLoading:function(){e.navOptionsHandler.firstLoad=!1,e.navOptionsHandler.loadingData=!1,e.navOptionsHandler.lastMessageTime=new Date},setStatusMessage:function(t){e.navOptionsHandler.statusMessage=t,e.navOptionsHandler.lastMessageTime=new Date}},e.filterHandler={changeFilter:function(t,i,n){e.search=i,e.filter.typeFilter=n}},e.widgetActionsHandler={actions:[],setActions:function(t){e.widgetActionsHandler.actions=t}};var d=e.$on("adfDashboardCollapseExpand",function(t,i){e.widgetState.isCollapsed=i.collapseExpandStatus}),c=e.$on("adfWidgetEnterEditMode",function(t,i){l.idEquals(a.wid,i.wid)&&e.edit()}),s=e.$on("adfIsEditMode",function(t,i){e.editing=!0}),f=e.$on("adfDashboardChanged",function(t,i,n){var o=[],a=n.grid;if(a&&a.length>0){a.forEach(function(e){var t=e.definition;o.push(t.wid)});var r=e.options.extraData&&e.options.extraData.widgetFilters,l=r.filter(function(e){var t=e.filter;return t&&!t.id||o.indexOf(t.id)!==-1});e.sharedFilters=angular.copy(l),e.editing=!1,e.$broadcast("widgetConfigChanged",o)}}),g=e.$on("adfDashboardEditsCancelled",function(t,i){e.editing=!1});e.openFullScreen=function(){e.$emit("adfOpenModalWidgetFromOther",a.type,e.config)},e.openAboutScreen=function(t){t="md";var i=o.open({animation:!0,templateUrl:"widgetAboutModal.html",controller:["$scope","$uibModalInstance","information",function(e,t,i){e.about={},e.about.info=i,e.ok=function(){t.close()}}],size:t,resolve:{information:function(){return e.config.about}}});i.result.then(function(t){e.selected=t},function(){n.info("Modal dismissed at: "+new Date)})},e.saveWidgetScreen=function(t){e.$emit("generateSnapshot",{objectSelector:".widget_"+t,fileName:"capture_"+(new Date).getTime()})};var u=function(t){var i,n={or:[]};return t.forEach(function(t){i={},i[t.operator]={},i[t.operator][t.name]=e.config.filter.value,n.or.push(i)}),n};e.downloadCsv=function(){var i,n=e.config.columns,o=e.config.filter,a={},r=e.config.sort?e.config.sort:t;if(e.config.windowFilter){var l=e.config.onWindowTimeChanged(e.config.windowFilter);l&&l.and&&(i={and:l.and})}var d;o.type&&"advanced"===o.type&&o.value.length>4?d=JSON.parse(o.value):o.type&&"basic"===o.type&&""!==o.value.trim()&&(d=u(e.config.fieldsQuickSearch,o.value)),a=i?d?{and:[i,d]}:i:d,e.$broadcast("downloadCsv",{columns:n,filter:a,order:r})},e.generateQR=function(){e.$broadcast("generateQR")};var p,m=e.$on("addItemToSelection",function(t,i){e.selectedItems[i.key]||(e.selectedItems[i.key]={data:i.data,visible:i.visible},e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!0,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))}),h=e.$on("removeItemFromSelection",function(t,i){e.selectedItems[i.key]&&(delete e.selectedItems[i.key],e.selectedItemsLength=Object.keys(e.selectedItems).length,i.isSelected=!1,e.selectionManager.lastItem=i,e.$broadcast("widgetSelectionChanged",e.selectionManager))});e.setReloadTimeout=function(){var i=e.config||e.definition.config;if(i){var n=i.reloadPeriod;isNaN(n)||1*n===0?p&&r.cancel(p):(angular.isDefined(p)&&(r.cancel(p),p=t),p=r(e.reload,1e3*n))}},e.reload=function(){e.$broadcast("widgetReload"),e.setReloadTimeout()},e.setReloadTimeout(),e.$on("$destroy",function(){d(),c(),s(),f(),g(),m(),h(),r.cancel(p)})}],compile:function(){return{pre:s,post:f}}}}]),angular.module("adf").factory("widgetService",["$http","$q","$sce","$templateCache","dashboard",function(e,t,i,n,o){function a(e){var t=e;return e.indexOf("{widgetsPath}")>=0&&(t=e.replace("{widgetsPath}",o.widgetsPath).replace("//","/"),0===t.indexOf("/")&&(t=t.substring(1))),t}var r={};return r.getTemplate=function(o){var r=t.defer();if(o.template)r.resolve(o.template);else if(o.templateUrl){var l=n.get(o.templateUrl);if(l)r.resolve(l);else{var d=i.getTrustedResourceUrl(a(o.templateUrl));e.get(d).success(function(e){n.put(o.templateUrl,e),r.resolve(e)}).error(function(){r.reject("could not load template")})}}return r.promise},r}])}(window);
//# sourceMappingURL=opengate-angular-dashboard-framework.min.js.map
